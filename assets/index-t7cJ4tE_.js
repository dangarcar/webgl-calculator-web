var ni=Object.defineProperty;var ii=(n,e,s)=>e in n?ni(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var Ee=(n,e,s)=>(ii(n,typeof e!="symbol"?e+"":e,s),s),nn=(n,e,s)=>{if(!e.has(n))throw TypeError("Cannot "+s)};var et=(n,e,s)=>(nn(n,e,"read from private field"),s?s.call(n):e.get(n)),Lt=(n,e,s)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,s)},_n=(n,e,s,r)=>(nn(n,e,"write to private field"),r?r.call(n,s):e.set(n,s),s);var rn=(n,e,s)=>(nn(n,e,"access private method"),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))r(u);new MutationObserver(u=>{for(const p of u)if(p.type==="childList")for(const v of p.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&r(v)}).observe(document,{childList:!0,subtree:!0});function s(u){const p={};return u.integrity&&(p.integrity=u.integrity),u.referrerPolicy&&(p.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?p.credentials="include":u.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function r(u){if(u.ep)return;u.ep=!0;const p=s(u);fetch(u.href,p)}})();(function(){function n(){}function e(l){var c=l.length-1;return function(){var t=k.call(arguments,0,c),i=k.call(arguments,c);return l.apply(this,t.concat([i]))}}function s(l){return e(function(c,t){typeof c!="function"&&(c=z(c));var i=function(o){return c.apply(o,[o].concat(t))};return l.call(this,i)})}function r(l){var c=k.call(arguments,1);return function(){return l.apply(this,c)}}function u(l,c){if(!c)throw new Error("prayer failed: "+l)}function p(l){u("a direction was passed",l===f||l===E)}function v(l,c,t){u("a parent is always present",l),u("leftward is properly set up",function(){return c?c[E]===t&&c.parent===l:l.ends[f]===t}()),u("rightward is properly set up",function(){return t?t[f]===c&&t.parent===l:l.ends[E]===c}())}function S(){window.console&&console.warn(`You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:

    MathQuill = MathQuill.getInterface(1);
    // now MathQuill.MathField() works like it used to

See also the "\`dev\` branch (2014–2015) → v0.10.0 Migration Guide" at
  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide`)}function B(l){return S(),xt(l)}function d(l){function c(b){var m,g;return b&&b.nodeType?(m=G(b).children(".mq-root-block").attr(Ne),g=m&&X.byId[m].controller,g?i[g.KIND_OF_MQ](g):null):null}function t(b,m){var g,x,T;m&&m.handlers&&(m.handlers={fns:m.handlers,APIClasses:i});for(g in m)m.hasOwnProperty(g)&&(x=m[g],T=ct[g],b[g]=T?T(x):x)}var i,o,h;if(!(Ht<=l&&l<=Qt))throw"Only interface versions between "+Ht+" and "+Qt+" supported. You specified: "+l;i={},c.L=f,c.R=E,c.saneKeyboardEvents=Gt,c.config=function(b){return t(Me.p,b),this},c.registerEmbed=function(b,m){if(!/^[a-z][a-z0-9]*$/i.test(b))throw"Embed name must start with letter and be only letters and digits";jt[b]=m},o=i.AbstractMathQuill=F(_t,function(b){b.init=function(m){this.__controller=m,this.__options=m.options,this.id=m.id,this.data=m.data},b.__mathquillify=function(m){var g,x=this.__controller,T=x.root,I=x.container;x.createTextarea(),g=I.addClass(m).contents().detach(),T.jQ=G('<span class="mq-root-block"/>').attr(Ne,T.id).appendTo(I),this.latex(g.text()),this.revert=function(){return I.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(g)}},b.config=function(m){return t(this.__options,m),this},b.el=function(){return this.__controller.container[0]},b.text=function(){return this.__controller.exportText()},b.latex=function(m){return arguments.length>0?(this.__controller.renderLatexMath(m),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},b.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},b.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),c.prototype=o.prototype,i.EditableField=F(o,function(b,m){b.__mathquillify=function(){return m.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},b.focus=function(){return this.__controller.textarea.focus(),this},b.blur=function(){return this.__controller.textarea.blur(),this},b.write=function(g){return this.__controller.writeLatex(g),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},b.cmd=function(g){var x,T=this.__controller.notify(),I=T.cursor;return/^\\[a-z]+$/i.test(g)?(g=g.slice(1),x=a[g],x&&(g=x(g),I.selection&&g.replaces(I.replaceSelection()),g.createLeftOf(I.show()),this.__controller.scrollHoriz())):I.parent.write(I,g),T.blurred&&I.hide().parent.blur(),this},b.select=function(){var g=this.__controller;for(g.notify("move").cursor.insAtRightEnd(g.root);g.cursor[f];)g.selectLeft();return this},b.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},b.moveToDirEnd=function(g){return this.__controller.notify("move").cursor.insAtDirEnd(g,this.__controller.root),this},b.moveToLeftEnd=function(){return this.moveToDirEnd(f)},b.moveToRightEnd=function(){return this.moveToDirEnd(E)},b.keystroke=function(g){var x;for(g=g.replace(/^\s+|\s+$/g,"").split(/\s+/),x=0;x<g.length;x+=1)this.__controller.keystroke(g[x],{preventDefault:n});return this},b.typedText=function(g){for(var x=0;x<g.length;x+=1)this.__controller.typedText(g.charAt(x));return this},b.dropEmbedded=function(g,x,T){var I,j=g-G(window).scrollLeft(),Q=x-G(window).scrollTop(),$=document.elementFromPoint(j,Q);this.__controller.seek(G($),g,x),I=Dn().setOptions(T),I.createLeftOf(this.__controller.cursor)},b.clickAt=function(g,x,T){T=T||document.elementFromPoint(g,x);var I=this.__controller,j=I.root;return dt.contains(j.jQ[0],T)||(T=j.jQ[0]),I.seek(G(T),g+pageXOffset,x+pageYOffset),I.blurred&&this.focus(),this},b.ignoreNextMousedown=function(g){return this.__controller.cursor.options.ignoreNextMousedown=g,this}}),c.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},c.EditableField.prototype=i.EditableField.prototype;for(h in Ie)(function(b,m){var g=i[b]=m(i);c[b]=function(x,T){var I,j=c(x);return j instanceof g||!x||!x.nodeType?j:(I=se(g.RootBlock(),G(x),Me()),I.KIND_OF_MQ=b,g(I).__mathquillify(T,l))},c[b].prototype=g.prototype})(h,Ie[h]);return c}function A(l){var c,t="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" ");for(c=0;c<t.length;c+=1)(function(i){l[i]=function(o){this.controller.handle(i,o)}})(t[c]);l.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function L(l,c,t){return F(ut,{ctrlSeq:l,htmlTemplate:"<"+c+" "+t+">&0</"+c+">"})}function C(l){var c=this.parent,t=l;do{if(t[E])return l.insLeftOf(c);t=t.parent.parent}while(t!==c);l.insRightOf(c)}function y(l,c){l.jQadd=function(){c.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},l.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));ft(this.delimjQs,In(1+.2*(t-1),1.2),1.2*t)}}function O(l,t){var t=t||l,i=Je[l],o=Je[t];te[l]=r(Fe,f,l,i,t,o),te[i]=r(Fe,E,l,i,t,o)}var q,k,z,F,f,E,G,me,X,ee,a,te,Ke,Ve,se,Ie,Me,ct,_t,jt,Ht,Qt,wn,N,Gt,Oe,Nt,ne,Se,w,Y,Ce,$t,ut,Qe,zt,xn,Cn,ge,Te,wt,ke,Ln,Yt,Pt,We,ze,ht,Ze,Ut,Xt,Kt,ft,Vt,Sn,Wt,On,Zt,Jt,De,_e,Ge,Fn,Bn,Tn,qn,en,Fe,Je,kn,Dn,xt,tn,dt=window.jQuery,Rn="mathquill-command-id",Ne="mathquill-block-id",In=Math.min,Mn=Math.max;if(!dt)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";k=[].slice,z=e(function(l,c){return e(function(t,i){if(l in t)return t[l].apply(t,c.concat(i))})}),F=function(l,c,t){function i(b){return typeof b=="object"}function o(b){return typeof b=="function"}function h(){}return function b(m,g){function x(){var $=new T;return o($.init)&&$.init.apply($,arguments),$}function T(){}var I,j,Q;return g===t&&(g=m,m=Object),x.Bare=T,I=h[l]=m[l],j=T[l]=x[l]=x.p=new h,j.constructor=x,x.extend=function($){return b(x,$)},(x.open=function($){if(Q={},o($)?Q=$.call(x,j,I,x,m):i($)&&(Q=$),i(Q))for(var ie in Q)c.call(Q,ie)&&(j[ie]=Q[ie]);return o(j.init)||(j.init=m),x})(g)}}("prototype",{}.hasOwnProperty),f=-1,E=1,G=F(dt,function(l){l.insDirOf=function(c,t){return c===f?this.insertBefore(t.first()):this.insertAfter(t.last())},l.insAtDirEnd=function(c,t){return c===f?this.prependTo(t):this.appendTo(t)}}),me=F(function(l){l.parent=0,l[f]=0,l[E]=0,l.init=function(c,t,i){this.parent=c,this[f]=t,this[E]=i},this.copy=function(c){return me(c.parent,c[f],c[E])}}),X=F(function(l){function c(){return t+=1}l[f]=0,l[E]=0,l.parent=0;var t=0;this.byId={},l.init=function(){this.id=c(),X.byId[this.id]=this,this.ends={},this.ends[f]=0,this.ends[E]=0},l.dispose=function(){delete X.byId[this.id]},l.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},l.jQ=G(),l.jQadd=function(i){return this.jQ=this.jQ.add(i)},l.jQize=function(i){function o(b){var m,g;for(b.getAttribute&&(m=b.getAttribute("mathquill-command-id"),g=b.getAttribute("mathquill-block-id"),m&&X.byId[m].jQadd(b),g&&X.byId[g].jQadd(b)),b=b.firstChild;b;b=b.nextSibling)o(b)}var h;for(i=G(i||this.html()),h=0;h<i.length;h+=1)o(i[h]);return i},l.createDir=function(i,o){p(i);var h=this;return h.jQize(),h.jQ.insDirOf(i,o.jQ),o[i]=h.adopt(o.parent,o[f],o[E]),h},l.createLeftOf=function(i){return this.createDir(f,i)},l.selectChildren=function(i,o){return Ve(i,o)},l.bubble=s(function(i){var o,h;for(o=this;o&&(h=i(o),h!==!1);o=o.parent);return this}),l.postOrder=s(function(i){return function o(h){h.eachChild(o),i(h)}(this),this}),l.isEmpty=function(){return this.ends[f]===0&&this.ends[E]===0},l.isStyleBlock=function(){return!1},l.children=function(){return ee(this.ends[f],this.ends[E])},l.eachChild=function(){var i=this.children();return i.each.apply(i,arguments),this},l.foldChildren=function(i,o){return this.children().fold(i,o)},l.withDirAdopt=function(i,o,h,b){return ee(this,this).withDirAdopt(i,o,h,b),this},l.adopt=function(i,o,h){return ee(this,this).adopt(i,o,h),this},l.disown=function(){return ee(this,this).disown(),this},l.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),ee=F(function(l){l.init=function(c,t,i){if(i===q&&(i=f),p(i),u("no half-empty fragments",!c==!t),this.ends={},c){u("withDir is passed to Fragment",c instanceof X),u("oppDir is passed to Fragment",t instanceof X),u("withDir and oppDir have the same parent",c.parent===t.parent),this.ends[i]=c,this.ends[-i]=t;var o=this.fold([],function(h,b){return h.push.apply(h,b.jQ.get()),h});this.jQ=this.jQ.add(o)}},l.jQ=G(),l.withDirAdopt=function(c,t,i,o){return c===f?this.adopt(t,i,o):this.adopt(t,o,i)},l.adopt=function(c,t,i){var o,h,b;return v(c,t,i),o=this,o.disowned=!1,(h=o.ends[f])?(b=o.ends[E],t||(c.ends[f]=h),i?i[f]=b:c.ends[E]=b,o.ends[E][E]=i,o.each(function(m){m[f]=t,m.parent=c,t&&(t[E]=m),t=m}),o):this},l.disown=function(){var c,t,i=this,o=i.ends[f];return!o||i.disowned||(i.disowned=!0,c=i.ends[E],t=o.parent,v(t,o[f],o),v(t,c,c[E]),o[f]?o[f][E]=c[E]:t.ends[f]=c[E],c[E]?c[E][f]=o[f]:t.ends[E]=o[f]),i},l.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},l.each=s(function(c){var t,i=this,o=i.ends[f];if(!o)return i;for(;o!==i.ends[E][E]&&(t=c(o),t!==!1);o=o[E]);return i}),l.fold=function(c,t){return this.each(function(i){c=t.call(this,c,i)}),c}}),a={},te={},Ke=F(me,function(l){l.init=function(c,t){this.parent=c,this.options=t;var i=this.jQ=this._jQ=G('<span class="mq-cursor">&#8203;</span>');this.blink=function(){i.toggleClass("mq-blink")},this.upDownCache={}},l.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[E]?this.selection&&this.selection.ends[f][f]===this[f]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[E].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},l.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=G(),this},l.withDirInsertAt=function(c,t,i,o){var h=this.parent;this.parent=t,this[c]=i,this[-c]=o,h!==t&&h.blur&&h.blur(this)},l.insDirOf=function(c,t){return p(c),this.jQ.insDirOf(c,t.jQ),this.withDirInsertAt(c,t.parent,t[c],t),this.parent.jQ.addClass("mq-hasCursor"),this},l.insLeftOf=function(c){return this.insDirOf(f,c)},l.insRightOf=function(c){return this.insDirOf(E,c)},l.insAtDirEnd=function(c,t){return p(c),this.jQ.insAtDirEnd(c,t.jQ),this.withDirInsertAt(c,t,0,t.ends[c]),t.focus(),this},l.insAtLeftEnd=function(c){return this.insAtDirEnd(f,c)},l.insAtRightEnd=function(c){return this.insAtDirEnd(E,c)},l.jumpUpDown=function(c,t){var i,o,h=this;h.upDownCache[c.id]=me.copy(h),i=h.upDownCache[t.id],i?i[E]?h.insLeftOf(i[E]):h.insAtRightEnd(i.parent):(o=h.offset().left,t.seek(o,h))},l.offset=function(){var c=this,t=c.jQ.removeClass("mq-cursor").offset();return c.jQ.addClass("mq-cursor"),t},l.unwrapGramp=function(){var c=this.parent.parent,t=c.parent,i=c[E],o=this,h=c[f];if(c.disown().eachChild(function(b){b.isEmpty()||(b.children().adopt(t,h,i).each(function(m){m.jQ.insertBefore(c.jQ.first())}),h=b.ends[E])}),!this[E])if(this[f])this[E]=this[f][E];else for(;!this[E];){if(this.parent=this.parent[E],!this.parent){this[E]=c[E],this.parent=t;break}this[E]=this.parent.ends[f]}this[E]?this.insLeftOf(this[E]):this.insAtRightEnd(t),c.jQ.remove(),c[f].siblingDeleted&&c[f].siblingDeleted(o.options,E),c[E].siblingDeleted&&c[E].siblingDeleted(o.options,f)},l.startSelection=function(){var c,t=this.anticursor=me.copy(this),i=t.ancestors={};for(c=t;c.parent;c=c.parent)i[c.parent.id]=c},l.endSelection=function(){delete this.anticursor},l.select=function(){var c,t,i,o,h,b,m,g=this.anticursor;if(this[f]===g[f]&&this.parent===g.parent)return!1;for(c=this;c.parent;c=c.parent)if(c.parent.id in g.ancestors){t=c.parent;break}if(u("cursor and anticursor in the same tree",t),i=g.ancestors[t.id],b=E,c[f]!==i){for(m=c;m;m=m[E])if(m[E]===i[E]){b=f,o=c,h=i;break}}return b===E&&(o=i,h=c),o instanceof me&&(o=o[E]),h instanceof me&&(h=h[f]),this.hide().selection=t.selectChildren(o,h),this.insDirOf(b,this.selection.ends[b]),this.selectionChanged(),!0},l.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},l.deleteSelection=function(){this.selection&&(this[f]=this.selection.ends[f][f],this[E]=this.selection.ends[E][E],this.selection.remove(),this.selectionChanged(),delete this.selection)},l.replaceSelection=function(){var c=this.selection;return c&&(this[f]=c.ends[f][f],this[E]=c.ends[E][E],delete this.selection),c}}),Ve=F(ee,function(l,c){l.init=function(){c.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},l.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),c.adopt.apply(this,arguments)},l.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},l.join=function(t){return this.fold("",function(i,o){return i+o[t]()})}}),se=F(function(l){l.init=function(t,i,o){this.id=t.id,this.data={},this.root=t,this.container=i,this.options=o,t.controller=this,this.cursor=t.cursor=Ke(t,o)},l.handle=function(t,i){var o,h=this.options.handlers;h&&h.fns[t]&&(o=h.APIClasses[this.KIND_OF_MQ](this),i===f||i===E?h.fns[t](i,o):h.fns[t](o))};var c=[];this.onNotify=function(t){c.push(t)},l.notify=function(){for(var t=0;t<c.length;t+=1)c[t].apply(this.cursor,arguments);return this}}),Ie={},Me=F(),ct={},_t=F(),jt={},B.prototype=_t.p,B.VERSION="v0.10.1",B.interfaceVersion=function(l){if(l!==1)throw"Only interface version 1 supported. You specified: "+l;return S=function(){window.console&&console.warn(`You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:

    MathQuill = MathQuill.getInterface(1);
    // now MathQuill.MathField() works like it used to

See also the "\`dev\` branch (2014–2015) → v0.10.0 Migration Guide" at
  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide`)},S(),B},B.getInterface=d,Ht=d.MIN=1,Qt=d.MAX=2,B.noConflict=function(){return window.MathQuill=wn,B},wn=window.MathQuill,window.MathQuill=B,N=F(function(l,c,t){function i(m,g){throw m=m?"'"+m+"'":"EOF","Parse Error: "+g+" at "+m}var o,h,b;l.init=function(m){this._=m},l.parse=function(m){function g(x,T){return T}return this.skip(b)._(""+m,g,i)},l.or=function(m){u("or is passed a parser",m instanceof t);var g=this;return t(function(x,T,I){function j(Q){return m._(x,T,I)}return g._(x,T,j)})},l.then=function(m){var g=this;return t(function(x,T,I){function j(Q,$){var ie=m instanceof t?m:m($);return u("a parser is returned",ie instanceof t),ie._(Q,T,I)}return g._(x,j,I)})},l.many=function(){var m=this;return t(function(g,x,T){function I($,ie){return g=$,Q.push(ie),!0}function j(){return!1}for(var Q=[];m._(g,I,j););return x(g,Q)})},l.times=function(m,g){arguments.length<2&&(g=m);var x=this;return t(function(T,I,j){function Q(re,Ye){return W.push(Ye),T=re,!0}function $(re,Ye){return Ae=Ye,T=re,!1}function ie(re,Ye){return!1}var Ae,ae,W=[],le=!0;for(ae=0;ae<m;ae+=1)if(le=x._(T,Q,$),!le)return j(T,Ae);for(;ae<g&&le;ae+=1)le=x._(T,Q,ie);return I(T,W)})},l.result=function(m){return this.then(h(m))},l.atMost=function(m){return this.times(0,m)},l.atLeast=function(m){var g=this;return g.times(m).then(function(x){return g.many().map(function(T){return x.concat(T)})})},l.map=function(m){return this.then(function(g){return h(m(g))})},l.skip=function(m){return this.then(function(g){return m.result(g)})},this.string=function(m){var g=m.length,x="expected '"+m+"'";return t(function(T,I,j){var Q=T.slice(0,g);return Q===m?I(T.slice(g),Q):j(T,x)})},o=this.regex=function(m){u("regexp parser is anchored",m.toString().charAt(1)==="^");var g="expected "+m;return t(function(x,T,I){var j,Q=m.exec(x);return Q?(j=Q[0],T(x.slice(j.length),j)):I(x,g)})},h=t.succeed=function(m){return t(function(g,x){return x(g,m)})},t.fail=function(m){return t(function(g,x,T){return T(g,m)})},t.letter=o(/^[a-z]/i),t.letters=o(/^[a-z]*/i),t.digit=o(/^[0-9]/),t.digits=o(/^[0-9]*/),t.whitespace=o(/^\s+/),t.optWhitespace=o(/^\s*/),t.any=t(function(m,g,x){return m?g(m.slice(1),m.charAt(0)):x(m,"expected any character")}),t.all=t(function(m,g,x){return g("",m)}),b=t.eof=t(function(m,g,x){return m?x(m,"expected EOF"):g(m,m)})}),Gt=function(){function l(t){var i,o=t.which||t.keyCode,h=c[o],b=[];return t.ctrlKey&&b.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&b.push("Meta"),t.altKey&&b.push("Alt"),t.shiftKey&&b.push("Shift"),i=h||String.fromCharCode(o),b.length||h?(b.push(i),b.join("-")):i}var c={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(t,i){function o(V){pt=V,clearTimeout(Ae),Ae=setTimeout(V)}function h(V){o(function(Ct){pt=n,clearTimeout(Ae),V(Ct)})}function b(V){pt(),pt=n,clearTimeout(Ae),re.val(V),V&&re[0].select&&re[0].select(),ae=!!V}function m(){var V=re[0];return"selectionStart"in V&&V.selectionStart!==V.selectionEnd}function g(){i.keystroke(l(W),W)}function x(V){W=V,le=null,ae&&h(function(Ct){Ct&&Ct.type==="focusout"||!re[0].select||re[0].select()}),g()}function T(V){W&&le&&g(),le=V,o(j)}function I(V){W&&!le&&o(j)}function j(){if(!m()){var V=re.val();V.length===1?(re.val(""),i.typedText(V)):V&&re[0].select&&re[0].select()}}function Q(){W=le=null}function $(V){re.focus(),o(ie)}function ie(){var V=re.val();re.val(""),V&&i.paste(V)}var Ae,ae,W=null,le=null,re=dt(t),Ye=dt(i.container||re),pt=n;return Ye.bind("keydown keypress input keyup focusout paste",function(V){pt(V)}),ae=!1,Ye.bind({keydown:x,keypress:T,keyup:I,focusout:Q,cut:function(){h(function(){i.cut()})},copy:function(){h(function(){i.copy()})},paste:$}),{select:b}}}(),se.open(function(l,c){l.exportText=function(){return this.root.foldChildren("",function(t,i){return t+i.text()})}}),se.open(function(l){l.focusBlurEvents=function(){function c(){clearTimeout(i),b.selection&&b.selection.jQ.addClass("mq-blur"),t()}function t(){b.hide().parent.blur(),o.container.removeClass("mq-focused"),G(window).unbind("blur",c)}var i,o=this,h=o.root,b=o.cursor;o.textarea.focus(function(){o.blurred=!1,clearTimeout(i),o.container.addClass("mq-focused"),b.parent||b.insAtRightEnd(h),b.selection?(b.selection.jQ.removeClass("mq-blur"),o.selectionChanged()):b.show()}).blur(function(){o.blurred=!0,i=setTimeout(function(){h.postOrder("intentionalBlur"),b.clearSelection().endSelection(),t()}),G(window).bind("blur",c)}),o.blurred=!0,b.hide().parent.blur()}}),se.open(function(l){l.keystroke=function(c,t){this.cursor.parent.keystroke(c,t,this)}}),X.open(function(l){l.keystroke=function(c,t,i){var o=i.cursor;switch(c){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":i.ctrlDeleteDir(f);break;case"Shift-Backspace":case"Backspace":i.backspace();break;case"Esc":case"Tab":return void i.escapeDir(E,c,t);case"Shift-Tab":case"Shift-Esc":return void i.escapeDir(f,c,t);case"End":i.notify("move").cursor.insAtRightEnd(o.parent);break;case"Ctrl-End":i.notify("move").cursor.insAtRightEnd(i.root);break;case"Shift-End":for(;o[E];)i.selectRight();break;case"Ctrl-Shift-End":for(;o[E]||o.parent!==i.root;)i.selectRight();break;case"Home":i.notify("move").cursor.insAtLeftEnd(o.parent);break;case"Ctrl-Home":i.notify("move").cursor.insAtLeftEnd(i.root);break;case"Shift-Home":for(;o[f];)i.selectLeft();break;case"Ctrl-Shift-Home":for(;o[f]||o.parent!==i.root;)i.selectLeft();break;case"Left":i.moveLeft();break;case"Shift-Left":i.selectLeft();break;case"Ctrl-Left":break;case"Right":i.moveRight();break;case"Shift-Right":i.selectRight();break;case"Ctrl-Right":break;case"Up":i.moveUp();break;case"Down":i.moveDown();break;case"Shift-Up":if(o[f])for(;o[f];)i.selectLeft();else i.selectLeft();case"Shift-Down":if(o[E])for(;o[E];)i.selectRight();else i.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":i.ctrlDeleteDir(E);break;case"Shift-Del":case"Del":i.deleteForward();break;case"Meta-A":case"Ctrl-A":for(i.notify("move").cursor.insAtRightEnd(i.root);o[f];)i.selectLeft();break;default:return}t.preventDefault(),i.scrollHoriz()},l.moveOutOf=l.moveTowards=l.deleteOutOf=l.deleteTowards=l.unselectInto=l.selectOutOf=l.selectTowards=function(){u("overridden or never called on this node")}}),se.open(function(l){function c(t,i){var o=t.notify("upDown").cursor,h=i+"Into",b=i+"OutOf";return o[E][h]?o.insAtLeftEnd(o[E][h]):o[f][h]?o.insAtRightEnd(o[f][h]):o.parent.bubble(function(m){var g=m[b];if(g&&(typeof g=="function"&&(g=m[b](o)),g instanceof X&&o.jumpUpDown(m,g),g!==!0))return!1}),t}this.onNotify(function(t){t!=="move"&&t!=="upDown"||this.show().clearSelection()}),l.escapeDir=function(t,i,o){p(t);var h=this.cursor;if(h.parent!==this.root&&o.preventDefault(),h.parent!==this.root)return h.parent.moveOutOf(t,h),this.notify("move")},ct.leftRightIntoCmdGoes=function(t){if(t&&t!=="up"&&t!=="down")throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},l.moveDir=function(t){p(t);var i=this.cursor,o=i.options.leftRightIntoCmdGoes;return i.selection?i.insDirOf(t,i.selection.ends[t]):i[t]?i[t].moveTowards(t,i,o):i.parent.moveOutOf(t,i,o),this.notify("move")},l.moveLeft=function(){return this.moveDir(f)},l.moveRight=function(){return this.moveDir(E)},l.moveUp=function(){return c(this,"up")},l.moveDown=function(){return c(this,"down")},this.onNotify(function(t){t!=="upDown"&&(this.upDownCache={})}),this.onNotify(function(t){t==="edit"&&this.show().deleteSelection()}),l.deleteDir=function(t){var i,o;return p(t),i=this.cursor,o=i.selection,this.notify("edit"),o||(i[t]?i[t].deleteTowards(t,i):i.parent.deleteOutOf(t,i)),i[f].siblingDeleted&&i[f].siblingDeleted(i.options,E),i[E].siblingDeleted&&i[E].siblingDeleted(i.options,f),i.parent.bubble("reflow"),this},l.ctrlDeleteDir=function(t){p(t);var i=this.cursor;return!i[f]||i.selection?this.deleteDir():(this.notify("edit"),ee(i.parent.ends[f],i[f]).remove(),i.insAtDirEnd(f,i.parent),i[f].siblingDeleted&&i[f].siblingDeleted(i.options,E),i[E].siblingDeleted&&i[E].siblingDeleted(i.options,f),i.parent.bubble("reflow"),this)},l.backspace=function(){return this.deleteDir(f)},l.deleteForward=function(){return this.deleteDir(E)},this.onNotify(function(t){t!=="select"&&this.endSelection()}),l.selectDir=function(t){var i,o=this.notify("select").cursor,h=o.selection;p(t),o.anticursor||o.startSelection(),i=o[t],i?h&&h.ends[t]===i&&o.anticursor[-t]!==i?i.unselectInto(t,o):i.selectTowards(t,o):o.parent.selectOutOf(t,o),o.clearSelection(),o.select()||o.show()},l.selectLeft=function(){return this.selectDir(f)},l.selectRight=function(){return this.selectDir(E)}}),Oe=function(){function l(W){var le=Ce();return W.adopt(le,0,0),le}function c(W){var le,re=W[0]||Ce();for(le=1;le<W.length;le+=1)W[le].children().adopt(re,re.ends[E],0);return re}var t=N.string,i=N.regex,o=N.letter,h=N.any,b=N.optWhitespace,m=N.succeed,g=N.fail,x=o.map(function(W){return Te(W)}),T=i(/^[^${}\\_^]/).map(function(W){return w(W)}),I=i(/^[^\\a-eg-zA-Z]/).or(t("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(h))).then(function(W){var le=a[W];return le?le(W).parser():g("unknown command: \\"+W)}),j=I.or(x).or(T),Q=t("{").then(function(){return ie}).skip(t("}")),$=b.then(Q.or(j.map(l))),ie=$.many().map(c).skip(b),Ae=t("[").then($.then(function(W){return W.join("latex")!=="]"?m(W):g()}).many().map(c).skip(b)).skip(t("]")),ae=ie;return ae.block=$,ae.optBlock=Ae,ae}(),se.open(function(l,c){l.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},l.writeLatex=function(t){var i,o=this.notify("edit").cursor,h=N.all,b=N.eof,m=Oe.skip(b).or(h.result(!1)).parse(t);return m&&!m.isEmpty()&&(m.children().adopt(o.parent,o[f],o[E]),i=m.jQize(),i.insertBefore(o.jQ),o[f]=m.ends[E],m.finalizeInsert(o.options,o),m.ends[E][E].siblingCreated&&m.ends[E][E].siblingCreated(o.options,f),m.ends[f][f].siblingCreated&&m.ends[f][f].siblingCreated(o.options,E),o.parent.bubble("reflow")),this},l.renderLatexMath=function(t){var i,o,h=this.root,b=this.cursor,m=N.all,g=N.eof,x=Oe.skip(g).or(m.result(!1)).parse(t);h.eachChild("postOrder","dispose"),h.ends[f]=h.ends[E]=0,x&&x.children().adopt(h,0,0),i=h.jQ,x?(o=x.join("html"),i.html(o),h.jQize(i.children()),h.finalizeInsert(b.options)):i.empty(),delete b.selection,b.insAtRightEnd(h)},l.renderLatexText=function(t){var i,o,h,b,m,g,x,T,I,j,Q=this.root,$=this.cursor;if(Q.jQ.children().slice(1).remove(),Q.eachChild("postOrder","dispose"),Q.ends[f]=Q.ends[E]=0,delete $.selection,$.show().insAtRightEnd(Q),i=N.regex,o=N.string,h=N.eof,b=N.all,m=o("$").then(Oe).skip(o("$").or(h)).map(function(ie){var Ae,ae=zt($);return ae.createBlocks(),Ae=ae.ends[f],ie.children().adopt(Ae,0,0),ae}),g=o("\\$").result("$"),x=g.or(i(/^[^$]/)).map(w),T=m.or(x).many(),I=T.skip(h).or(b.result(!1)).parse(t)){for(j=0;j<I.length;j+=1)I[j].adopt(Q,Q.ends[E],0);Q.jQize().appendTo(Q.jQ),Q.finalizeInsert($.options)}}}),se.open(function(l){Me.p.ignoreNextMousedown=n,l.delegateMouseEvents=function(){var c=this.root.jQ;this.container.bind("mousedown.mathquill",function(t){function i($){b=G($.target)}function o($){T.anticursor||T.startSelection(),x.seek(b,$.pageX,$.pageY).cursor.select(),b=q}function h($){T.blink=I,T.selection||(x.editable?T.show():j.detach()),m.unbind("mousemove",i),G($.target.ownerDocument).unbind("mousemove",o).unbind("mouseup",h)}var b,m=G(t.target).closest(".mq-root-block"),g=X.byId[m.attr(Ne)||c.attr(Ne)],x=g.controller,T=x.cursor,I=T.blink,j=x.textareaSpan,Q=x.textarea;t.preventDefault(),t.target.unselectable=!0,T.options.ignoreNextMousedown(t)||(T.options.ignoreNextMousedown=n,x.blurred&&(x.editable||m.prepend(j),Q.focus()),T.blink=n,x.seek(G(t.target),t.pageX,t.pageY).cursor.startSelection(),m.mousemove(i),G(t.target.ownerDocument).mousemove(o).mouseup(h))})}}),se.open(function(l){l.seek=function(c,t,i){var o,h,b,m=this.notify("select").cursor;return c&&(o=c.attr(Ne)||c.attr(Rn),o||(h=c.parent(),o=h.attr(Ne)||h.attr(Rn))),b=o?X.byId[o]:this.root,u("nodeId is the id of some Node that exists",b),m.clearSelection().show(),b.seek(t,m),this.scrollHoriz(),this}}),se.open(function(l){l.scrollHoriz=function(){var c,t,i,o,h,b=this.cursor,m=b.selection,g=this.root.jQ[0].getBoundingClientRect();if(m)if(i=m.jQ[0].getBoundingClientRect(),o=i.left-(g.left+20),h=i.right-(g.right-20),m.ends[f]===b[E])if(o<0)t=o;else{if(!(h>0))return;t=i.left-h<g.left+20?o:h}else if(h>0)t=h;else{if(!(o<0))return;t=i.right-o>g.right-20?h:o}else if(c=b.jQ[0].getBoundingClientRect().left,c>g.right-20)t=c-(g.right-20);else{if(!(c<g.left+20))return;t=c-(g.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+t},100)}}),se.open(function(l){Me.p.substituteTextarea=function(){return G("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},l.createTextarea=function(){var c,t=this.textareaSpan=G('<span class="mq-textarea"></span>'),i=this.options.substituteTextarea();if(!i.nodeType)throw"substituteTextarea() must return a DOM element, got "+i;i=this.textarea=G(i).appendTo(t),c=this,c.cursor.selectionChanged=function(){c.selectionChanged()}},l.selectionChanged=function(){var c=this;Vt(c.container[0]),c.textareaSelectionTimeout===q&&(c.textareaSelectionTimeout=setTimeout(function(){c.setTextareaSelection()}))},l.setTextareaSelection=function(){this.textareaSelectionTimeout=q;var c="";this.cursor.selection&&(c=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(c="$"+c+"$")),this.selectFn(c)},l.staticMathTextareaEvents=function(){function c(){h.detach(),t.blurred=!0}var t=this,i=(t.root,t.cursor),o=t.textarea,h=t.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+t.exportLatex()+"$</span>"),t.blurred=!0,o.bind("cut paste",!1).bind("copy",function(){t.setTextareaSelection()}).focus(function(){t.blurred=!1}).blur(function(){i.selection&&i.selection.clear(),setTimeout(c)}),t.selectFn=function(b){o.val(b),b&&o.select()}},Me.p.substituteKeyboardEvents=Gt,l.editablesTextareaEvents=function(){var c=this,t=c.textarea,i=c.textareaSpan,o=this.options.substituteKeyboardEvents(t,this);this.selectFn=function(h){o.select(h)},this.container.prepend(i),this.focusBlurEvents()},l.typedText=function(c){if(c===`
`)return this.handle("enter");var t=this.notify().cursor;t.parent.write(t,c),this.scrollHoriz()},l.cut=function(){var c=this,t=c.cursor;t.selection&&setTimeout(function(){c.notify("edit"),t.parent.bubble("reflow")})},l.copy=function(){this.setTextareaSelection()},l.paste=function(c){this.options.statelessClipboard&&(c=c.slice(0,1)==="$"&&c.slice(-1)==="$"?c.slice(1,-1):"\\text{"+c+"}"),this.writeLatex(c).cursor.show()}}),Nt=F(X,function(l,c){l.finalizeInsert=function(t,i){var o=this;o.postOrder("finalizeTree",t),o.postOrder("contactWeld",i),o.postOrder("blur"),o.postOrder("reflow"),o[E].siblingCreated&&o[E].siblingCreated(t,f),o[f].siblingCreated&&o[f].siblingCreated(t,E),o.bubble("reflow")}}),ne=F(Nt,function(l,c){l.init=function(t,i,o){var h=this;c.init.call(h),h.ctrlSeq||(h.ctrlSeq=t),i&&(h.htmlTemplate=i),o&&(h.textTemplate=o)},l.replaces=function(t){t.disown(),this.replacedFragment=t},l.isEmpty=function(){return this.foldChildren(!0,function(t,i){return t&&i.isEmpty()})},l.parser=function(){var t=Oe.block,i=this;return t.times(i.numBlocks()).map(function(o){i.blocks=o;for(var h=0;h<o.length;h+=1)o[h].adopt(i,i.ends[E],0);return i})},l.createLeftOf=function(t){var i=this,o=i.replacedFragment;i.createBlocks(),c.createLeftOf.call(i,t),o&&(o.adopt(i.ends[f],0,0),o.jQ.appendTo(i.ends[f].jQ)),i.finalizeInsert(t.options),i.placeCursor(t)},l.createBlocks=function(){var t,i,o=this,h=o.numBlocks(),b=o.blocks=Array(h);for(t=0;t<h;t+=1)i=b[t]=Ce(),i.adopt(o,o.ends[E],0)},l.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[f],function(i,o){return i.isEmpty()?i:o}))},l.moveTowards=function(t,i,o){var h=o&&this[o+"Into"];i.insAtDirEnd(-t,h||this.ends[-t])},l.deleteTowards=function(t,i){this.isEmpty()?i[t]=this.remove()[t]:this.moveTowards(t,i,null)},l.selectTowards=function(t,i){i[-t]=this,i[t]=this[t]},l.selectChildren=function(){return Ve(this,this)},l.unselectInto=function(t,i){i.insAtDirEnd(-t,i.anticursor.ancestors[this.id])},l.seek=function(t,i){function o(g){var x={};return x[f]=g.jQ.offset().left,x[E]=x[f]+g.jQ.outerWidth(),x}var h,b=this,m=o(b);return t<m[f]?i.insLeftOf(b):t>m[E]?i.insRightOf(b):(h=m[f],void b.eachChild(function(g){var x=o(g);return t<x[f]?(t-h<x[f]-t?g[f]?i.insAtRightEnd(g[f]):i.insLeftOf(b):i.insAtLeftEnd(g),!1):t>x[E]?void(g[E]?h=x[E]:m[E]-t<t-x[E]?i.insRightOf(b):i.insAtRightEnd(g)):(g.seek(t,i),!1)}))},l.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},l.html=function(){var t,i,o,h=this,b=h.blocks,m=" mathquill-command-id="+h.id,g=h.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(u("no unmatched angle brackets",g.join("")===this.htmlTemplate),t=0,i=g[0];i;t+=1,i=g[t])if(i.slice(-2)==="/>")g[t]=i.slice(0,-2)+m+"/>";else if(i.charAt(0)==="<"){u("not an unmatched top-level close tag",i.charAt(1)!=="/"),g[t]=i.slice(0,-1)+m+">",o=1;do t+=1,i=g[t],u("no missing close tags",i),i.slice(0,2)==="</"?o-=1:i.charAt(0)==="<"&&i.slice(-2)!=="/>"&&(o+=1);while(o>0)}return g.join("").replace(/>&(\d+)/g,function(x,T){return" mathquill-block-id="+b[T].id+">"+b[T].join("html")})},l.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,i){return t+"{"+(i.latex()||" ")+"}"})},l.textTemplate=[""],l.text=function(){var t=this,i=0;return t.foldChildren(t.textTemplate[i],function(o,h){i+=1;var b=h.text();return o&&t.textTemplate[i]==="("&&b[0]==="("&&b.slice(-1)===")"?o+b.slice(1,-1)+t.textTemplate[i]:o+h.text()+(t.textTemplate[i]||"")})}}),Se=F(ne,function(l,c){l.init=function(t,i,o){o||(o=t&&t.length>1?t.slice(1):t),c.init.call(this,t,i,[o])},l.parser=function(){return N.succeed(this)},l.numBlocks=function(){return 0},l.replaces=function(t){t.remove()},l.createBlocks=n,l.moveTowards=function(t,i){i.jQ.insDirOf(t,this.jQ),i[-t]=this,i[t]=this[t]},l.deleteTowards=function(t,i){i[t]=this.remove()[t]},l.seek=function(t,i){t-this.jQ.offset().left<this.jQ.outerWidth()/2?i.insLeftOf(this):i.insRightOf(this)},l.latex=function(){return this.ctrlSeq},l.text=function(){return this.textTemplate},l.placeCursor=n,l.isEmpty=function(){return!0}}),w=F(Se,function(l,c){l.init=function(t,i){c.init.call(this,t,"<span>"+(i||t)+"</span>")}}),Y=F(Se,function(l,c){l.init=function(t,i,o){c.init.call(this,t,'<span class="mq-binary-operator">'+i+"</span>",o)}}),Ce=F(Nt,function(l,c){l.join=function(t){return this.foldChildren("",function(i,o){return i+o[t]()})},l.html=function(){return this.join("html")},l.latex=function(){return this.join("latex")},l.text=function(){return this.ends[f]===this.ends[E]&&this.ends[f]!==0?this.ends[f].text():this.join("text")},l.keystroke=function(t,i,o){return!o.options.spaceBehavesLikeTab||t!=="Spacebar"&&t!=="Shift-Spacebar"?c.keystroke.apply(this,arguments):(i.preventDefault(),void o.escapeDir(t==="Shift-Spacebar"?f:E,t,i))},l.moveOutOf=function(t,i,o){var h=o&&this.parent[o+"Into"];!h&&this[t]?i.insAtDirEnd(-t,this[t]):i.insDirOf(t,this.parent)},l.selectOutOf=function(t,i){i.insDirOf(t,this.parent)},l.deleteOutOf=function(t,i){i.unwrapGramp()},l.seek=function(t,i){var o=this.ends[E];if(!o||o.jQ.offset().left+o.jQ.outerWidth()<t)return i.insAtRightEnd(this);if(t<this.ends[f].jQ.offset().left)return i.insAtLeftEnd(this);for(;t<o.jQ.offset().left;)o=o[f];return o.seek(t,i)},l.chToCmd=function(t,i){var o;return t.match(/^[a-eg-zA-Z]$/)?Te(t):/^\d$/.test(t)?Cn(t):i&&i.typingSlashWritesDivisionSymbol&&t==="/"?a["÷"](t):i&&i.typingAsteriskWritesTimesSymbol&&t==="*"?a["×"](t):(o=te[t]||a[t])?o(t):w(t)},l.write=function(t,i){var o=this.chToCmd(i,t.options);t.selection&&o.replaces(t.replaceSelection()),o.createLeftOf(t.show())},l.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},l.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),Ie.StaticMath=function(l){return F(l.AbstractMathQuill,function(c,t){this.RootBlock=Ce,c.__mathquillify=function(i,o){return this.config(i),t.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},c.init=function(){t.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],l.MathField)},c.latex=function(){var i=t.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],l.MathField),i}})},$t=F(Ce,A),Ie.MathField=function(l){return F(l.EditableField,function(c,t){this.RootBlock=$t,c.__mathquillify=function(i,o){return this.config(i),o>1&&(this.__controller.root.reflow=n),t.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},ut=F(X,function(l,c){function t(i){var o,h;if(i.jQ[0].normalize(),o=i.jQ[0].firstChild)return u("only node in TextBlock span is Text node",o.nodeType===3),h=Qe(o.data),h.jQadd(o),i.children().disown(),h.adopt(i,0,0)}l.ctrlSeq="\\text",l.replaces=function(i){i instanceof ee?this.replacedText=i.remove().jQ.text():typeof i=="string"&&(this.replacedText=i)},l.jQadd=function(i){c.jQadd.call(this,i),this.ends[f]&&this.ends[f].jQadd(this.jQ[0].firstChild)},l.createLeftOf=function(i){var o,h=this;if(c.createLeftOf.call(this,i),h[E].siblingCreated&&h[E].siblingCreated(i.options,f),h[f].siblingCreated&&h[f].siblingCreated(i.options,E),h.bubble("reflow"),i.insAtRightEnd(h),h.replacedText)for(o=0;o<h.replacedText.length;o+=1)h.write(i,h.replacedText.charAt(o))},l.parser=function(){var i=this,o=N.string,h=N.regex,b=N.optWhitespace;return b.then(o("{")).then(h(/^[^}]*/)).skip(o("}")).map(function(m){return m.length===0?ee():(Qe(m).adopt(i,0,0),i)})},l.textContents=function(){return this.foldChildren("",function(i,o){return i+o.text})},l.text=function(){return'"'+this.textContents()+'"'},l.latex=function(){var i=this.textContents();return i.length===0?"":"\\text{"+i+"}"},l.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},l.moveTowards=function(i,o){o.insAtDirEnd(-i,this)},l.moveOutOf=function(i,o){o.insDirOf(i,this)},l.unselectInto=l.moveTowards,l.selectTowards=ne.prototype.selectTowards,l.deleteTowards=ne.prototype.deleteTowards,l.selectOutOf=function(i,o){o.insDirOf(i,this)},l.deleteOutOf=function(i,o){this.isEmpty()&&o.insRightOf(this)},l.write=function(i,o){var h,b;i.show().deleteSelection(),o!=="$"?i[f]?i[f].appendText(o):Qe(o).createLeftOf(i):this.isEmpty()?(i.insRightOf(this),w("\\$","$").createLeftOf(i)):i[E]?i[f]?(h=ut(),b=this.ends[f],b.disown().jQ.detach(),b.adopt(h,0,0),i.insLeftOf(this),c.createLeftOf.call(h,i)):i.insLeftOf(this):i.insRightOf(this)},l.seek=function(i,o){var h,b,m,g,x,T,I,j;for(o.hide(),h=t(this),b=this.jQ.width()/this.text.length,m=Math.round((i-this.jQ.offset().left)/b),m<=0?o.insAtLeftEnd(this):m>=h.text.length?o.insAtRightEnd(this):o.insLeftOf(h.splitRight(m)),g=i-o.show().offset().left,x=g&&g<0?f:E,T=x;o[x]&&g*T>0;)o[x].moveTowards(x,o),T=g,g=i-o.offset().left;x*g<-x*T&&o[-x].moveTowards(-x,o),o.anticursor?o.anticursor.parent===this&&(I=o[f]&&o[f].text.length,this.anticursorPosition===I?o.anticursor=me.copy(o):(this.anticursorPosition<I?(j=o[f].splitRight(this.anticursorPosition),o[f]=j):j=o[E].splitRight(this.anticursorPosition-I),o.anticursor=me(this,j[f],j))):this.anticursorPosition=o[f]&&o[f].text.length},l.blur=function(i){Ce.prototype.blur.call(this),i&&(this.textContents()===""?(this.remove(),i[f]===this?i[f]=this[f]:i[E]===this&&(i[E]=this[E])):t(this))},l.focus=Ce.prototype.focus}),Qe=F(X,function(l,c){function t(i,o){return o.charAt(i===f?0:-1+o.length)}l.init=function(i){c.init.call(this),this.text=i},l.jQadd=function(i){this.dom=i,this.jQ=G(i)},l.jQize=function(){return this.jQadd(document.createTextNode(this.text))},l.appendText=function(i){this.text+=i,this.dom.appendData(i)},l.prependText=function(i){this.text=i+this.text,this.dom.insertData(0,i)},l.insTextAtDirEnd=function(i,o){p(o),o===E?this.appendText(i):this.prependText(i)},l.splitRight=function(i){var o=Qe(this.text.slice(i)).adopt(this.parent,this,this[E]);return o.jQadd(this.dom.splitText(i)),this.text=this.text.slice(0,i),o},l.moveTowards=function(i,o){var h,b;return p(i),h=t(-i,this.text),b=this[-i],b?b.insTextAtDirEnd(h,i):Qe(h).createDir(-i,o),this.deleteTowards(i,o)},l.latex=function(){return this.text},l.deleteTowards=function(i,o){this.text.length>1?i===E?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),o[i]=this[i])},l.selectTowards=function(i,o){var h,b,m,g;return p(i),h=o.anticursor,b=t(-i,this.text),h[i]===this?(m=Qe(b).createDir(i,o),h[i]=m,o.insDirOf(i,m)):(g=this[-i],g?g.insTextAtDirEnd(b,i):(m=Qe(b).createDir(-i,o),m.jQ.insDirOf(-i,o.selection.jQ)),this.text.length===1&&h[-i]===this&&(h[-i]=this[-i])),this.deleteTowards(i,o)}}),a.text=a.textnormal=a.textrm=a.textup=a.textmd=ut,a.em=a.italic=a.italics=a.emph=a.textit=a.textsl=L("\\textit","i",'class="mq-text-mode"'),a.strong=a.bold=a.textbf=L("\\textbf","b",'class="mq-text-mode"'),a.sf=a.textsf=L("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),a.tt=a.texttt=L("\\texttt","span",'class="mq-monospace mq-text-mode"'),a.textsc=L("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),a.uppercase=L("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),a.lowercase=L("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),zt=F(ne,function(l,c){l.init=function(t){c.init.call(this,"$"),this.cursor=t},l.htmlTemplate='<span class="mq-math-mode">&0</span>',l.createBlocks=function(){c.createBlocks.call(this),this.ends[f].cursor=this.cursor,this.ends[f].write=function(t,i){i!=="$"?Ce.prototype.write.call(this,t,i):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),w("\\$","$").createLeftOf(t.show())):t[E]?t[f]?Ce.prototype.write.call(this,t,i):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},l.latex=function(){return"$"+this.ends[f].latex()+"$"}}),xn=F($t,function(l,c){l.keystroke=function(t){if(t!=="Spacebar"&&t!=="Shift-Spacebar")return c.keystroke.apply(this,arguments)},l.write=function(t,i){if(t.show().deleteSelection(),i==="$")zt(t).createLeftOf(t);else{var o;i==="<"?o="&lt;":i===">"&&(o="&gt;"),w(i,o).createLeftOf(t)}}}),Ie.TextField=function(l){return F(l.EditableField,function(c,t){this.RootBlock=xn,c.__mathquillify=function(){return t.__mathquillify.call(this,"mq-editable-field mq-text-mode")},c.latex=function(i){return arguments.length>0?(this.__controller.renderLatexText(i),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},te["\\"]=F(ne,function(l,c){l.ctrlSeq="\\",l.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},l.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',l.textTemplate=["\\"],l.createBlocks=function(){c.createBlocks.call(this),this.ends[f].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[f].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[f].write=function(t,i){t.show().deleteSelection(),i.match(/[a-z]/i)?w(i).createLeftOf(t):(this.parent.renderCommand(t),i==="\\"&&this.isEmpty()||this.parent.parent.write(t,i))},this.ends[f].keystroke=function(t,i,o){return t==="Tab"||t==="Enter"||t==="Spacebar"?(this.parent.renderCommand(o.cursor),void i.preventDefault()):c.keystroke.apply(this,arguments)}},l.createLeftOf=function(t){if(c.createLeftOf.call(this,t),this._replacedFragment){var i=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(o){return G(o.target=i).trigger(o),!1}).insertBefore(this.jQ).add(this.jQ)}},l.latex=function(){return"\\"+this.ends[f].latex()+" "},l.renderCommand=function(t){var i,o;this.jQ=this.jQ.last(),this.remove(),this[E]?t.insLeftOf(this[E]):t.insAtRightEnd(this.parent),i=this.ends[f].latex(),i||(i=" "),o=a[i],o?(o=o(i),this._replacedFragment&&o.replaces(this._replacedFragment),o.createLeftOf(t)):(o=ut(),o.replaces(i),o.createLeftOf(t),t.insRightOf(o),this._replacedFragment&&this._replacedFragment.remove())}}),a.notin=a.cong=a.equiv=a.oplus=a.otimes=F(Y,function(l,c){l.init=function(t){c.init.call(this,"\\"+t+" ","&"+t+";")}}),a["≠"]=a.ne=a.neq=r(Y,"\\ne ","&ne;"),a["∗"]=a.ast=a.star=a.loast=a.lowast=r(Y,"\\ast ","&lowast;"),a.therefor=a.therefore=r(Y,"\\therefore ","&there4;"),a.cuz=a.because=r(Y,"\\because ","&#8757;"),a.prop=a.propto=r(Y,"\\propto ","&prop;"),a["≈"]=a.asymp=a.approx=r(Y,"\\approx ","&asymp;"),a.isin=a.in=r(Y,"\\in ","&isin;"),a.ni=a.contains=r(Y,"\\ni ","&ni;"),a.notni=a.niton=a.notcontains=a.doesnotcontain=r(Y,"\\not\\ni ","&#8716;"),a.sub=a.subset=r(Y,"\\subset ","&sub;"),a.sup=a.supset=a.superset=r(Y,"\\supset ","&sup;"),a.nsub=a.notsub=a.nsubset=a.notsubset=r(Y,"\\not\\subset ","&#8836;"),a.nsup=a.notsup=a.nsupset=a.notsupset=a.nsuperset=a.notsuperset=r(Y,"\\not\\supset ","&#8837;"),a.sube=a.subeq=a.subsete=a.subseteq=r(Y,"\\subseteq ","&sube;"),a.supe=a.supeq=a.supsete=a.supseteq=a.supersete=a.superseteq=r(Y,"\\supseteq ","&supe;"),a.nsube=a.nsubeq=a.notsube=a.notsubeq=a.nsubsete=a.nsubseteq=a.notsubsete=a.notsubseteq=r(Y,"\\not\\subseteq ","&#8840;"),a.nsupe=a.nsupeq=a.notsupe=a.notsupeq=a.nsupsete=a.nsupseteq=a.notsupsete=a.notsupseteq=a.nsupersete=a.nsuperseteq=a.notsupersete=a.notsuperseteq=r(Y,"\\not\\supseteq ","&#8841;"),a.N=a.naturals=a.Naturals=r(w,"\\mathbb{N}","&#8469;"),a.P=a.primes=a.Primes=a.projective=a.Projective=a.probability=a.Probability=r(w,"\\mathbb{P}","&#8473;"),a.Z=a.integers=a.Integers=r(w,"\\mathbb{Z}","&#8484;"),a.Q=a.rationals=a.Rationals=r(w,"\\mathbb{Q}","&#8474;"),a.R=a.reals=a.Reals=r(w,"\\mathbb{R}","&#8477;"),a.C=a.complex=a.Complex=a.complexes=a.Complexes=a.complexplane=a.Complexplane=a.ComplexPlane=r(w,"\\mathbb{C}","&#8450;"),a.H=a.Hamiltonian=a.quaternions=a.Quaternions=r(w,"\\mathbb{H}","&#8461;"),a.quad=a.emsp=r(w,"\\quad ","    "),a.qquad=r(w,"\\qquad ","        "),a.diamond=r(w,"\\diamond ","&#9671;"),a.bigtriangleup=r(w,"\\bigtriangleup ","&#9651;"),a.ominus=r(w,"\\ominus ","&#8854;"),a.uplus=r(w,"\\uplus ","&#8846;"),a.bigtriangledown=r(w,"\\bigtriangledown ","&#9661;"),a.sqcap=r(w,"\\sqcap ","&#8851;"),a.triangleleft=r(w,"\\triangleleft ","&#8882;"),a.sqcup=r(w,"\\sqcup ","&#8852;"),a.triangleright=r(w,"\\triangleright ","&#8883;"),a.odot=a.circledot=r(w,"\\odot ","&#8857;"),a.bigcirc=r(w,"\\bigcirc ","&#9711;"),a.dagger=r(w,"\\dagger ","&#0134;"),a.ddagger=r(w,"\\ddagger ","&#135;"),a.wr=r(w,"\\wr ","&#8768;"),a.amalg=r(w,"\\amalg ","&#8720;"),a.models=r(w,"\\models ","&#8872;"),a.prec=r(w,"\\prec ","&#8826;"),a.succ=r(w,"\\succ ","&#8827;"),a.preceq=r(w,"\\preceq ","&#8828;"),a.succeq=r(w,"\\succeq ","&#8829;"),a.simeq=r(w,"\\simeq ","&#8771;"),a.mid=r(w,"\\mid ","&#8739;"),a.ll=r(w,"\\ll ","&#8810;"),a.gg=r(w,"\\gg ","&#8811;"),a.parallel=r(w,"\\parallel ","&#8741;"),a.nparallel=r(w,"\\nparallel ","&#8742;"),a.bowtie=r(w,"\\bowtie ","&#8904;"),a.sqsubset=r(w,"\\sqsubset ","&#8847;"),a.sqsupset=r(w,"\\sqsupset ","&#8848;"),a.smile=r(w,"\\smile ","&#8995;"),a.sqsubseteq=r(w,"\\sqsubseteq ","&#8849;"),a.sqsupseteq=r(w,"\\sqsupseteq ","&#8850;"),a.doteq=r(w,"\\doteq ","&#8784;"),a.frown=r(w,"\\frown ","&#8994;"),a.vdash=r(w,"\\vdash ","&#8870;"),a.dashv=r(w,"\\dashv ","&#8867;"),a.nless=r(w,"\\nless ","&#8814;"),a.ngtr=r(w,"\\ngtr ","&#8815;"),a.longleftarrow=r(w,"\\longleftarrow ","&#8592;"),a.longrightarrow=r(w,"\\longrightarrow ","&#8594;"),a.Longleftarrow=r(w,"\\Longleftarrow ","&#8656;"),a.Longrightarrow=r(w,"\\Longrightarrow ","&#8658;"),a.longleftrightarrow=r(w,"\\longleftrightarrow ","&#8596;"),a.updownarrow=r(w,"\\updownarrow ","&#8597;"),a.Longleftrightarrow=r(w,"\\Longleftrightarrow ","&#8660;"),a.Updownarrow=r(w,"\\Updownarrow ","&#8661;"),a.mapsto=r(w,"\\mapsto ","&#8614;"),a.nearrow=r(w,"\\nearrow ","&#8599;"),a.hookleftarrow=r(w,"\\hookleftarrow ","&#8617;"),a.hookrightarrow=r(w,"\\hookrightarrow ","&#8618;"),a.searrow=r(w,"\\searrow ","&#8600;"),a.leftharpoonup=r(w,"\\leftharpoonup ","&#8636;"),a.rightharpoonup=r(w,"\\rightharpoonup ","&#8640;"),a.swarrow=r(w,"\\swarrow ","&#8601;"),a.leftharpoondown=r(w,"\\leftharpoondown ","&#8637;"),a.rightharpoondown=r(w,"\\rightharpoondown ","&#8641;"),a.nwarrow=r(w,"\\nwarrow ","&#8598;"),a.ldots=r(w,"\\ldots ","&#8230;"),a.cdots=r(w,"\\cdots ","&#8943;"),a.vdots=r(w,"\\vdots ","&#8942;"),a.ddots=r(w,"\\ddots ","&#8945;"),a.surd=r(w,"\\surd ","&#8730;"),a.triangle=r(w,"\\triangle ","&#9651;"),a.ell=r(w,"\\ell ","&#8467;"),a.top=r(w,"\\top ","&#8868;"),a.flat=r(w,"\\flat ","&#9837;"),a.natural=r(w,"\\natural ","&#9838;"),a.sharp=r(w,"\\sharp ","&#9839;"),a.wp=r(w,"\\wp ","&#8472;"),a.bot=r(w,"\\bot ","&#8869;"),a.clubsuit=r(w,"\\clubsuit ","&#9827;"),a.diamondsuit=r(w,"\\diamondsuit ","&#9826;"),a.heartsuit=r(w,"\\heartsuit ","&#9825;"),a.spadesuit=r(w,"\\spadesuit ","&#9824;"),a.parallelogram=r(w,"\\parallelogram ","&#9649;"),a.square=r(w,"\\square ","&#11036;"),a.oint=r(w,"\\oint ","&#8750;"),a.bigcap=r(w,"\\bigcap ","&#8745;"),a.bigcup=r(w,"\\bigcup ","&#8746;"),a.bigsqcup=r(w,"\\bigsqcup ","&#8852;"),a.bigvee=r(w,"\\bigvee ","&#8744;"),a.bigwedge=r(w,"\\bigwedge ","&#8743;"),a.bigodot=r(w,"\\bigodot ","&#8857;"),a.bigotimes=r(w,"\\bigotimes ","&#8855;"),a.bigoplus=r(w,"\\bigoplus ","&#8853;"),a.biguplus=r(w,"\\biguplus ","&#8846;"),a.lfloor=r(w,"\\lfloor ","&#8970;"),a.rfloor=r(w,"\\rfloor ","&#8971;"),a.lceil=r(w,"\\lceil ","&#8968;"),a.rceil=r(w,"\\rceil ","&#8969;"),a.opencurlybrace=a.lbrace=r(w,"\\lbrace ","{"),a.closecurlybrace=a.rbrace=r(w,"\\rbrace ","}"),a.lbrack=r(w,"["),a.rbrack=r(w,"]"),a.slash=r(w,"/"),a.vert=r(w,"|"),a.perp=a.perpendicular=r(w,"\\perp ","&perp;"),a.nabla=a.del=r(w,"\\nabla ","&nabla;"),a.hbar=r(w,"\\hbar ","&#8463;"),a.AA=a.Angstrom=a.angstrom=r(w,"\\text\\AA ","&#8491;"),a.ring=a.circ=a.circle=r(w,"\\circ ","&#8728;"),a.bull=a.bullet=r(w,"\\bullet ","&bull;"),a.setminus=a.smallsetminus=r(w,"\\setminus ","&#8726;"),a.not=a["¬"]=a.neg=r(w,"\\neg ","&not;"),a["…"]=a.dots=a.ellip=a.hellip=a.ellipsis=a.hellipsis=r(w,"\\dots ","&hellip;"),a.converges=a.darr=a.dnarr=a.dnarrow=a.downarrow=r(w,"\\downarrow ","&darr;"),a.dArr=a.dnArr=a.dnArrow=a.Downarrow=r(w,"\\Downarrow ","&dArr;"),a.diverges=a.uarr=a.uparrow=r(w,"\\uparrow ","&uarr;"),a.uArr=a.Uparrow=r(w,"\\Uparrow ","&uArr;"),a.to=r(Y,"\\to ","&rarr;"),a.rarr=a.rightarrow=r(w,"\\rightarrow ","&rarr;"),a.implies=r(Y,"\\Rightarrow ","&rArr;"),a.rArr=a.Rightarrow=r(w,"\\Rightarrow ","&rArr;"),a.gets=r(Y,"\\gets ","&larr;"),a.larr=a.leftarrow=r(w,"\\leftarrow ","&larr;"),a.impliedby=r(Y,"\\Leftarrow ","&lArr;"),a.lArr=a.Leftarrow=r(w,"\\Leftarrow ","&lArr;"),a.harr=a.lrarr=a.leftrightarrow=r(w,"\\leftrightarrow ","&harr;"),a.iff=r(Y,"\\Leftrightarrow ","&hArr;"),a.hArr=a.lrArr=a.Leftrightarrow=r(w,"\\Leftrightarrow ","&hArr;"),a.Re=a.Real=a.real=r(w,"\\Re ","&real;"),a.Im=a.imag=a.image=a.imagin=a.imaginary=a.Imaginary=r(w,"\\Im ","&image;"),a.part=a.partial=r(w,"\\partial ","&part;"),a.infty=a.infin=a.infinity=r(w,"\\infty ","&infin;"),a.alef=a.alefsym=a.aleph=a.alephsym=r(w,"\\aleph ","&alefsym;"),a.xist=a.xists=a.exist=a.exists=r(w,"\\exists ","&exist;"),a.nexists=a.nexist=r(w,"\\nexists ","&#8708;"),a.and=a.land=a.wedge=r(w,"\\wedge ","&and;"),a.or=a.lor=a.vee=r(w,"\\vee ","&or;"),a.o=a.O=a.empty=a.emptyset=a.oslash=a.Oslash=a.nothing=a.varnothing=r(Y,"\\varnothing ","&empty;"),a.cup=a.union=r(Y,"\\cup ","&cup;"),a.cap=a.intersect=a.intersection=r(Y,"\\cap ","&cap;"),a.deg=a.degree=r(w,"\\degree ","&deg;"),a.ang=a.angle=r(w,"\\angle ","&ang;"),a.measuredangle=r(w,"\\measuredangle ","&#8737;"),Cn=F(w,function(l,c){l.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[f]instanceof ge&&t[f].isItalic!==!1||t[f]instanceof _e&&t[f][f]instanceof ge&&t[f][f].isItalic!==!1)?(a._().createLeftOf(t),c.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):c.createLeftOf.call(this,t)}}),ge=F(Se,function(l,c){l.init=function(t,i){c.init.call(this,t,"<var>"+(i||t)+"</var>")},l.text=function(){var t=this.ctrlSeq;return this.isPartOfOperator?t[0]=="\\"?t=t.slice(1,t.length):t[t.length-1]==" "&&(t=t.slice(0,-1)):(!this[f]||this[f]instanceof ge||this[f]instanceof Y||this[f].ctrlSeq==="\\ "||(t="*"+t),!this[E]||this[E]instanceof Y||this[E]instanceof _e||(t+="*")),t}}),Me.p.autoCommands={_maxLength:0},ct.autoCommands=function(l){var c,t,i,o,h;if(!/^[a-z]+(?: [a-z]+)*$/i.test(l))throw'"'+l+'" not a space-delimited list of only letters';for(c=l.split(" "),t={},i=0,o=0;o<c.length;o+=1){if(h=c[o],h.length<2)throw'autocommand "'+h+'" not minimum length of 2';if(a[h]===Yt)throw'"'+h+'" is a built-in operator name';t[h]=1,i=Mn(i,h.length)}return t._maxLength=i,t},Te=F(ge,function(l,c){function t(i){return!i||i instanceof Y||i instanceof Ge}l.init=function(i){return c.init.call(this,this.letter=i)},l.createLeftOf=function(i){var o,h,b,m,g;if(c.createLeftOf.apply(this,arguments),o=i.options.autoCommands,h=o._maxLength,h>0){for(b="",m=this,g=0;m instanceof Te&&m.ctrlSeq===m.letter&&g<h;)b=m.letter+b,m=m[f],g+=1;for(;b.length;){if(o.hasOwnProperty(b)){for(g=1,m=this;g<b.length;g+=1,m=m[f]);return ee(m,this).remove(),i[f]=m[f],a[b](b).createLeftOf(i)}b=b.slice(1)}}},l.italicize=function(i){return this.isItalic=i,this.isPartOfOperator=!i,this.jQ.toggleClass("mq-operator-name",!i),this},l.finalizeTree=l.siblingDeleted=l.siblingCreated=function(i,o){o!==f&&this[E]instanceof Te||this.autoUnItalicize(i)},l.autoUnItalicize=function(i){var o,h,b,m,g,x,T,I,j,Q,$,ie,Ae=i.autoOperatorNames;if(Ae._maxLength!==0){for(o=this.letter,h=this[f];h instanceof Te;h=h[f])o=h.letter+o;for(b=this[E];b instanceof Te;b=b[E])o+=b.letter;ee(h[E]||this.parent.ends[f],b[f]||this.parent.ends[E]).each(function(ae){ae.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),ae.ctrlSeq=ae.letter});e:for(m=0,g=h[E]||this.parent.ends[f];m<o.length;m+=1,g=g[E])for(x=In(Ae._maxLength,o.length-m);x>0;x-=1)if(T=o.slice(m,m+x),Ae.hasOwnProperty(T)){for(I=0,j=g;I<x;I+=1,j=j[E])j.italicize(!1),Q=j;$=wt.hasOwnProperty(T),g.ctrlSeq=($?"\\":"\\operatorname{")+g.ctrlSeq,Q.ctrlSeq+=$?" ":"}",Ln.hasOwnProperty(T)&&Q[f][f][f].jQ.addClass("mq-last"),t(g[f])||g.jQ.addClass("mq-first"),t(Q[E])||(Q[E]instanceof _e?(ie=Q[E],(ie.siblingCreated=ie.siblingDeleted=function(){ie.jQ.toggleClass("mq-after-operator-name",!(ie[E]instanceof Fe))})()):Q.jQ.toggleClass("mq-last",!(Q[E]instanceof Fe))),m+=x-1,g=Q;continue e}}}}),wt={},ke=Me.p.autoOperatorNames={_maxLength:9},Ln={limsup:1,liminf:1,projlim:1,injlim:1},function(){var l,c,t,i,o="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(l=0;l<o.length;l+=1)wt[o[l]]=ke[o[l]]=1;for(c="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),l=0;l<c.length;l+=1)wt[c[l]]=1;for(t="sin cos tan sec cosec csc cotan cot ctg".split(" "),l=0;l<t.length;l+=1)ke[t[l]]=ke["arc"+t[l]]=ke[t[l]+"h"]=ke["ar"+t[l]+"h"]=ke["arc"+t[l]+"h"]=1;for(i="gcf hcf lcm proj span".split(" "),l=0;l<i.length;l+=1)ke[i[l]]=1}(),ct.autoOperatorNames=function(l){var c,t,i,o,h;if(!/^[a-z]+(?: [a-z]+)*$/i.test(l))throw'"'+l+'" not a space-delimited list of only letters';for(c=l.split(" "),t={},i=0,o=0;o<c.length;o+=1){if(h=c[o],h.length<2)throw'"'+h+'" not minimum length of 2';t[h]=1,i=Mn(i,h.length)}return t._maxLength=i,t},Yt=F(Se,function(l,c){l.init=function(t){this.ctrlSeq=t},l.createLeftOf=function(t){var i,o=this.ctrlSeq;for(i=0;i<o.length;i+=1)Te(o.charAt(i)).createLeftOf(t)},l.parser=function(){var t,i=this.ctrlSeq,o=Ce();for(t=0;t<i.length;t+=1)Te(i.charAt(t)).adopt(o,o.ends[E],0);return N.succeed(o.children())}});for(Pt in ke)ke.hasOwnProperty(Pt)&&(a[Pt]=Yt);a.operatorname=F(ne,function(l){l.createLeftOf=n,l.numBlocks=function(){return 1},l.parser=function(){return Oe.block.map(function(c){return c.children()})}}),a.f=F(Te,function(l,c){l.init=function(){Se.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},l.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),c.italicize.apply(this,arguments)}}),a[" "]=a.space=r(w,"\\ ","&nbsp;"),a["'"]=a.prime=r(w,"'","&prime;"),a["″"]=a.dprime=r(w,"″","&Prime;"),a.backslash=r(w,"\\backslash ","\\"),te["\\"]||(te["\\"]=a.backslash),a.$=r(w,"\\$","$"),We=F(Se,function(l,c){l.init=function(t,i){c.init.call(this,t,'<span class="mq-nonSymbola">'+(i||t)+"</span>")}}),a["@"]=We,a["&"]=r(We,"\\&","&amp;"),a["%"]=r(We,"\\%","%"),a.alpha=a.beta=a.gamma=a.delta=a.zeta=a.eta=a.theta=a.iota=a.kappa=a.mu=a.nu=a.xi=a.rho=a.sigma=a.tau=a.chi=a.psi=a.omega=F(ge,function(l,c){l.init=function(t){c.init.call(this,"\\"+t+" ","&"+t+";")}}),a.phi=r(ge,"\\phi ","&#981;"),a.phiv=a.varphi=r(ge,"\\varphi ","&phi;"),a.epsilon=r(ge,"\\epsilon ","&#1013;"),a.epsiv=a.varepsilon=r(ge,"\\varepsilon ","&epsilon;"),a.piv=a.varpi=r(ge,"\\varpi ","&piv;"),a.sigmaf=a.sigmav=a.varsigma=r(ge,"\\varsigma ","&sigmaf;"),a.thetav=a.vartheta=a.thetasym=r(ge,"\\vartheta ","&thetasym;"),a.upsilon=a.upsi=r(ge,"\\upsilon ","&upsilon;"),a.gammad=a.Gammad=a.digamma=r(ge,"\\digamma ","&#989;"),a.kappav=a.varkappa=r(ge,"\\varkappa ","&#1008;"),a.rhov=a.varrho=r(ge,"\\varrho ","&#1009;"),a.pi=a.π=r(We,"\\pi ","&pi;"),a.lambda=r(We,"\\lambda ","&lambda;"),a.Upsilon=a.Upsi=a.upsih=a.Upsih=r(Se,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),a.Gamma=a.Delta=a.Theta=a.Lambda=a.Xi=a.Pi=a.Sigma=a.Phi=a.Psi=a.Omega=a.forall=F(w,function(l,c){l.init=function(t){c.init.call(this,"\\"+t+" ","&"+t+";")}}),ze=F(ne,function(l){l.init=function(c){this.latex=c},l.createLeftOf=function(c){var t=Oe.parse(this.latex);t.children().adopt(c.parent,c[f],c[E]),c[f]=t.ends[E],t.jQize().insertBefore(c.jQ),t.finalizeInsert(c.options,c),t.ends[E][E].siblingCreated&&t.ends[E][E].siblingCreated(c.options,f),t.ends[f][f].siblingCreated&&t.ends[f][f].siblingCreated(c.options,E),c.parent.bubble("reflow")},l.parser=function(){var c=Oe.parse(this.latex).children();return N.succeed(c)}}),a["¹"]=r(ze,"^1"),a["²"]=r(ze,"^2"),a["³"]=r(ze,"^3"),a["¼"]=r(ze,"\\frac14"),a["½"]=r(ze,"\\frac12"),a["¾"]=r(ze,"\\frac34"),ht=F(Y,function(l){l.init=w.prototype.init,l.contactWeld=l.siblingCreated=l.siblingDeleted=function(c,t){function i(o){return o[f]?o[f]instanceof Y||/^[,;:\(\[]$/.test(o[f].ctrlSeq)?"":"mq-binary-operator":o.parent&&o.parent.parent&&o.parent.parent.isStyleBlock()?i(o.parent.parent):""}if(t!==E)return this.jQ[0].className=i(this),this}}),a["+"]=r(ht,"+","+"),a["–"]=a["-"]=r(ht,"-","&minus;"),a["±"]=a.pm=a.plusmn=a.plusminus=r(ht,"\\pm ","&plusmn;"),a.mp=a.mnplus=a.minusplus=r(ht,"\\mp ","&#8723;"),te["*"]=a.sdot=a.cdot=r(Y,"\\cdot ","&middot;","*"),Ze=F(Y,function(l,c){l.init=function(t,i){this.data=t,this.strict=i;var o=i?"Strict":"";c.init.call(this,t["ctrlSeq"+o],t["html"+o],t["text"+o])},l.swap=function(t){this.strict=t;var i=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+i],this.jQ.html(this.data["html"+i]),this.textTemplate=[this.data["text"+i]]},l.deleteTowards=function(t,i){return t!==f||this.strict?void c.deleteTowards.apply(this,arguments):(this.swap(!0),void this.bubble("reflow"))}}),Ut={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},Xt={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},a["<"]=a.lt=r(Ze,Ut,!0),a[">"]=a.gt=r(Ze,Xt,!0),a["≤"]=a.le=a.leq=r(Ze,Ut,!1),a["≥"]=a.ge=a.geq=r(Ze,Xt,!1),Kt=F(Y,function(l,c){l.init=function(){c.init.call(this,"=","=")},l.createLeftOf=function(t){return t[f]instanceof Ze&&t[f].strict?(t[f].swap(!1),void t[f].bubble("reflow")):void c.createLeftOf.apply(this,arguments)}}),a["="]=Kt,a["×"]=a.times=r(Y,"\\times ","&times;","[x]"),a["÷"]=a.div=a.divide=a.divides=r(Y,"\\div ","&divide;","[/]"),te["~"]=a.sim=r(Y,"\\sim ","~","~"),Vt=n,Sn=document.createElement("div"),Wt=Sn.style,On={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(Jt in On)if(Jt in Wt){Zt=Jt;break}Zt?ft=function(l,c,t){l.css(Zt,"scale("+c+","+t+")")}:"filter"in Wt?(Vt=function(l){l.className=l.className},ft=function(l,c,t){function i(){l.css("marginRight",(o.width()-1)*(c-1)/c+"px")}var o,h;c/=1+(t-1)/2,l.css("fontSize",t+"em"),l.hasClass("mq-matrixed-container")||l.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>'),o=l.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+c+",SizingMethod='auto expand')"),i(),h=setInterval(i),G(window).load(function(){clearTimeout(h),i()})}):ft=function(l,c,t){l.css("fontSize",t+"em")},De=F(ne,function(l,c){l.init=function(t,i,o){c.init.call(this,t,"<"+i+" "+o+">&0</"+i+">")}}),a.mathrm=r(De,"\\mathrm","span",'class="mq-roman mq-font"'),a.mathit=r(De,"\\mathit","i",'class="mq-font"'),a.mathbf=r(De,"\\mathbf","b",'class="mq-font"'),a.mathsf=r(De,"\\mathsf","span",'class="mq-sans-serif mq-font"'),a.mathtt=r(De,"\\mathtt","span",'class="mq-monospace mq-font"'),a.underline=r(De,"\\underline","span",'class="mq-non-leaf mq-underline"'),a.overline=a.bar=r(De,"\\overline","span",'class="mq-non-leaf mq-overline"'),a.overrightarrow=r(De,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),a.overleftarrow=r(De,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),a.textcolor=F(ne,function(l,c){l.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},l.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},l.parser=function(){var t=this,i=N.optWhitespace,o=N.string,h=N.regex;return i.then(o("{")).then(h(/^[#\w\s.,()%-]*/)).skip(o("}")).then(function(b){return t.setColor(b),c.parser.call(t)})},l.isStyleBlock=function(){return!0}}),a.class=F(ne,function(l,c){l.parser=function(){var t=this,i=N.string,o=N.regex;return N.optWhitespace.then(i("{")).then(o(/^[-\w\s\\\xA0-\xFF]*/)).skip(i("}")).then(function(h){return t.cls=h||"",t.htmlTemplate='<span class="mq-class '+h+'">&0</span>',c.parser.call(t)})},l.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},l.isStyleBlock=function(){return!0}}),_e=F(ne,function(l,c){l.ctrlSeq="_{...}^{...}",l.createLeftOf=function(t){if(this.replacedFragment||t[f]||!t.options.supSubsRequireOperand)return c.createLeftOf.apply(this,arguments)},l.contactWeld=function(t){var i,o,h,b,m,g;for(i=f;i;i=i===f&&E)if(this[i]instanceof _e){for(o="sub";o;o=o==="sub"&&"sup")h=this[o],b=this[i][o],h&&(b?h.isEmpty()?g=me(b,0,b.ends[f]):(h.jQ.children().insAtDirEnd(-i,b.jQ),m=h.children().disown(),g=me(b,m.ends[E],b.ends[f]),i===f?m.adopt(b,b.ends[E],0):m.adopt(b,0,b.ends[f])):this[i].addBlock(h.disown()),this.placeCursor=function(x,T){return function(I){I.insAtDirEnd(-i,x||T)}}(b,h));this.remove(),t&&t[f]===this&&(i===E&&g?g[f]?t.insRightOf(g[f]):t.insAtLeftEnd(g.parent):t.insRightOf(this[i]));break}},Me.p.charsThatBreakOutOfSupSub="",l.finalizeTree=function(){this.ends[f].write=function(t,i){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if(i==="_")return;var o=this.chToCmd(i,t.options);return o instanceof Se?t.deleteSelection():t.clearSelection().insRightOf(this.parent),o.createLeftOf(t.show())}t[f]&&!t[E]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(i)>-1&&t.insRightOf(this.parent),Ce.p.write.apply(this,arguments)}},l.moveTowards=function(t,i,o){i.options.autoSubscriptNumerals&&!this.sup?i.insDirOf(t,this):c.moveTowards.apply(this,arguments)},l.deleteTowards=function(t,i){if(i.options.autoSubscriptNumerals&&this.sub){var o=this.sub.ends[-t];o instanceof Se?o.remove():o&&o.deleteTowards(t,i.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(f,i.insAtLeftEnd(this.sub)),this.sup&&i.insDirOf(-t,this))}else c.deleteTowards.apply(this,arguments)},l.latex=function(){function t(i,o){var h=o&&o.latex();return o?i+(h.length===1?h:"{"+(h||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},l.addBlock=function(t){this.supsub==="sub"?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=G('<span class="mq-sup"/>').append(t.jQ.children()).attr(Ne,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=G('<span class="mq-sub"></span>').append(t.jQ.children()).attr(Ne,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var i=0;i<2;i+=1)(function(o,h,b,m){o[h].deleteOutOf=function(g,x){if(x.insDirOf(this[g]?-g:g,this.parent),!this.isEmpty()){var T=this.ends[g];this.children().disown().withDirAdopt(g,x.parent,x[g],x[-g]).jQ.insDirOf(-g,x.jQ),x[-g]=T}o.supsub=b,delete o[h],delete o[m+"Into"],o[b][m+"OutOf"]=C,delete o[b].deleteOutOf,h==="sub"&&G(o.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}})(this,"sub sup".split(" ")[i],"sup sub".split(" ")[i],"down up".split(" ")[i])}}),a.subscript=a._=F(_e,function(l,c){l.supsub="sub",l.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',l.textTemplate=["_"],l.finalizeTree=function(){this.downInto=this.sub=this.ends[f],this.sub.upOutOf=C,c.finalizeTree.call(this)}}),a.superscript=a.supscript=a["^"]=F(_e,function(l,c){l.supsub="sup",l.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',l.textTemplate=["^"],l.finalizeTree=function(){this.upInto=this.sup=this.ends[E],this.sup.downOutOf=C,c.finalizeTree.call(this)}}),Ge=F(ne,function(l,c){l.init=function(t,i){var o='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+i+'</big><span class="mq-from"><span>&0</span></span></span>';Se.prototype.init.call(this,t,o)},l.createLeftOf=function(t){c.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(Te("n").createLeftOf(t),Kt().createLeftOf(t))},l.latex=function(){function t(i){return i.length===1?i:"{"+(i||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[f].latex())+"^"+t(this.ends[E].latex())},l.parser=function(){var t,i=N.string,o=N.optWhitespace,h=N.succeed,b=Oe.block,m=this,g=m.blocks=[Ce(),Ce()];for(t=0;t<g.length;t+=1)g[t].adopt(m,m.ends[E],0);return o.then(i("_").or(i("^"))).then(function(x){var T=g[x==="_"?0:1];return b.then(function(I){return I.children().adopt(T,T.ends[E],0),h(m)})}).many().result(m)},l.finalizeTree=function(){this.downInto=this.ends[f],this.upInto=this.ends[E],this.ends[f].upOutOf=this.ends[E],this.ends[E].downOutOf=this.ends[f]}}),a["∑"]=a.sum=a.summation=r(Ge,"\\sum ","&sum;"),a["∏"]=a.prod=a.product=r(Ge,"\\prod ","&prod;"),a.coprod=a.coproduct=r(Ge,"\\coprod ","&#8720;"),a["∫"]=a.int=a.integral=F(Ge,function(l,c){l.init=function(){var t='<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>';Se.prototype.init.call(this,"\\int ",t)},l.createLeftOf=ne.p.createLeftOf}),Fn=a.frac=a.dfrac=a.cfrac=a.fraction=F(ne,function(l,c){l.ctrlSeq="\\frac",l.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',l.textTemplate=["(",")/(",")"],l.finalizeTree=function(){this.upInto=this.ends[E].upOutOf=this.ends[f],this.downInto=this.ends[f].downOutOf=this.ends[E]}}),Bn=a.over=te["/"]=F(Fn,function(l,c){l.createLeftOf=function(t){if(!this.replacedFragment){for(var i=t[f];i&&!(i instanceof Y||i instanceof(a.text||n)||i instanceof Ge||i.ctrlSeq==="\\ "||/^[,;:]$/.test(i.ctrlSeq));)i=i[f];i instanceof Ge&&i[E]instanceof _e&&(i=i[E],i[E]instanceof _e&&i[E].ctrlSeq!=i.ctrlSeq&&(i=i[E])),i!==t[f]&&(this.replaces(ee(i[E]||t.parent.ends[f],t[f])),t[f]=i)}c.createLeftOf.call(this,t)}}),Tn=a.sqrt=a["√"]=F(ne,function(l,c){l.ctrlSeq="\\sqrt",l.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',l.textTemplate=["sqrt(",")"],l.parser=function(){return Oe.optBlock.then(function(t){return Oe.block.map(function(i){var o=qn();return o.blocks=[t,i],t.adopt(o,0,0),i.adopt(o,t,0),o})}).or(c.parser.call(this))},l.reflow=function(){var t=this.ends[E].jQ;ft(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),a.hat=F(ne,function(l,c){l.ctrlSeq="\\hat",l.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',l.textTemplate=["hat(",")"]}),qn=a.nthroot=F(Tn,function(l,c){l.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',l.textTemplate=["sqrt[","](",")"],l.latex=function(){return"\\sqrt["+this.ends[f].latex()+"]{"+this.ends[E].latex()+"}"}}),en=F(ne,function(l,c){l.init=function(t,i,o){var h='<span class="mq-non-leaf"><span class="mq-diacritic-above">'+i+'</span><span class="mq-diacritic-stem">&0</span></span>';c.init.call(this,t,h,o)}}),a.vec=r(en,"\\vec","&rarr;",["vec(",")"]),a.tilde=r(en,"\\tilde","~",["tilde(",")"]),Fe=F(F(ne,y),function(l,c){l.init=function(t,i,o,h,b){c.init.call(this,"\\left"+h,q,[i,o]),this.side=t,this.sides={},this.sides[f]={ch:i,ctrlSeq:h},this.sides[E]={ch:o,ctrlSeq:b}},l.numBlocks=function(){return 1},l.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===E?" mq-ghost":"")+'">'+this.sides[f].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===f?" mq-ghost":"")+'">'+this.sides[E].ch+"</span></span>",c.html.call(this)},l.latex=function(){return"\\left"+this.sides[f].ctrlSeq+this.ends[f].latex()+"\\right"+this.sides[E].ctrlSeq},l.matchBrack=function(t,i,o){return o instanceof Fe&&o.side&&o.side!==-i&&(!t.restrictMismatchedBrackets||Je[this.sides[this.side].ch]===o.sides[o.side].ch||{"(":"]","[":")"}[this.sides[f].ch]===o.sides[E].ch)&&o},l.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===f?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},l.createLeftOf=function(t){var i,o,h;this.replacedFragment||(i=t.options,o=this.sides[f].ch==="|"?this.matchBrack(i,E,t[E])||this.matchBrack(i,f,t[f])||this.matchBrack(i,0,t.parent.parent):this.matchBrack(i,-this.side,t[-this.side])||this.matchBrack(i,-this.side,t.parent.parent)),o?(h=this.side=-o.side,this.closeOpposing(o),o===t.parent.parent&&t[h]&&ee(t[h],t.parent.ends[h],-h).disown().withDirAdopt(-h,o.parent,o,o[h]).jQ.insDirOf(h,o.jQ),o.bubble("reflow")):(o=this,h=o.side,o.replacedFragment?o.side=0:t[-h]&&(o.replaces(ee(t[-h],t.parent.ends[-h],h)),t[-h]=0),c.createLeftOf.call(o,t)),h===f?t.insAtLeftEnd(o.ends[f]):t.insRightOf(o)},l.placeCursor=n,l.unwrap=function(){this.ends[f].children().disown().adopt(this.parent,this,this[E]).jQ.insertAfter(this.jQ),this.remove()},l.deleteSide=function(t,i,o){var h,b,m,g=this.parent,x=this[t],T=g.ends[t];if(t===this.side)return this.unwrap(),void(x?o.insDirOf(-t,x):o.insAtDirEnd(t,g));if(h=o.options,b=!this.side,this.side=-t,this.matchBrack(h,t,this.ends[f].ends[this.side]))this.closeOpposing(this.ends[f].ends[this.side]),m=this.ends[f].ends[t],this.unwrap(),m.siblingCreated&&m.siblingCreated(o.options,t),x?o.insDirOf(-t,x):o.insAtDirEnd(t,g);else{if(this.matchBrack(h,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(i&&b)return this.unwrap(),void(x?o.insDirOf(-t,x):o.insAtDirEnd(t,g));this.sides[t]={ch:Je[this.sides[this.side].ch],ctrlSeq:Je[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===f?0:1).addClass("mq-ghost").html(this.sides[t].ch)}x?(m=this.ends[f].ends[t],ee(x,T,-t).disown().withDirAdopt(-t,this.ends[f],m,0).jQ.insAtDirEnd(t,this.ends[f].jQ.removeClass("mq-empty")),m.siblingCreated&&m.siblingCreated(o.options,t),o.insDirOf(-t,x)):i?o.insDirOf(t,this):o.insAtDirEnd(t,this.ends[f])}},l.deleteTowards=function(t,i){this.deleteSide(-t,!1,i)},l.finalizeTree=function(){this.ends[f].deleteOutOf=function(t,i){this.parent.deleteSide(t,!0,i)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===f?1:0).removeClass("mq-ghost"),this.side=0}},l.siblingCreated=function(t,i){i===-this.side&&this.finalizeTree()}}),Je={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},O("("),O("["),O("{","\\{"),a.langle=r(Fe,f,"&lang;","&rang;","\\langle ","\\rangle "),a.rangle=r(Fe,E,"&lang;","&rang;","\\langle ","\\rangle "),te["|"]=r(Fe,f,"|","|","|","|"),a.lVert=r(Fe,f,"&#8741;","&#8741;","\\lVert ","\\rVert "),a.rVert=r(Fe,E,"&#8741;","&#8741;","\\lVert ","\\rVert "),a.left=F(ne,function(l){l.parser=function(){var c=N.regex,t=N.string,i=(N.succeed,N.optWhitespace);return i.then(c(/^(?:[([|]|\\\{|\\langle\b|\\lVert\b)/)).then(function(o){var h=o.charAt(0)==="\\"?o.slice(1):o;return o=="\\langle"&&(h="&lang;",o+=" "),o=="\\lVert"&&(h="&#8741;",o+=" "),Oe.then(function(b){return t("\\right").skip(i).then(c(/^(?:[\])|]|\\\}|\\rangle\b|\\rVert\b)/)).map(function(m){var g,x=m.charAt(0)==="\\"?m.slice(1):m;return m=="\\rangle"&&(x="&rang;",m+=" "),m=="\\rVert"&&(x="&#8741;",m+=" "),g=Fe(0,h,x,o,m),g.blocks=[b],b.adopt(g,0,0),g})})})}}),a.right=F(ne,function(l){l.parser=function(){return N.fail("unmatched \\right")}}),kn=a.binom=a.binomial=F(F(ne,y),function(l,c){l.ctrlSeq="\\binom",l.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',l.textTemplate=["choose(",",",")"]}),a.choose=F(kn,function(l){l.createLeftOf=Bn.prototype.createLeftOf}),a.editable=a.MathQuillMathField=F(ne,function(l,c){l.ctrlSeq="\\MathQuillMathField",l.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',l.parser=function(){var t=this,i=N.string,o=N.regex,h=N.succeed;return i("[").then(o(/^[a-z][a-z0-9]*/i)).skip(i("]")).map(function(b){t.name=b}).or(h()).then(c.parser.call(t))},l.finalizeTree=function(t){var i=se(this.ends[f],this.jQ,t);i.KIND_OF_MQ="MathField",i.editable=!0,i.createTextarea(),i.editablesTextareaEvents(),i.cursor.insAtRightEnd(i.root),A(i.root)},l.registerInnerField=function(t,i){t.push(t[this.name]=i(this.ends[f].controller))},l.latex=function(){return this.ends[f].latex()},l.text=function(){return this.ends[f].text()}}),Dn=a.embed=F(Se,function(l,c){l.setOptions=function(t){function i(){return""}return this.text=t.text||i,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||i,this},l.parser=function(){var t=this,i=N.string,o=N.regex,h=N.succeed;return i("{").then(o(/^[a-z][a-z0-9]*/i)).skip(i("}")).then(function(b){return i("[").then(o(/^[-\w\s]*/)).skip(i("]")).or(h()).map(function(m){return t.setOptions(jt[b](m))})})}}),xt=d(1);for(tn in xt)(function(l,c){typeof c=="function"?(B[l]=function(){return S(),c.apply(this,arguments)},B[l].prototype=c.prototype):B[l]=c})(tn,xt[tn])})();var ri=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function si(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var zn={exports:{}};/*! @preserve
 * numeral.js
 * version : 2.0.6
 * author : Adam Draper
 * license : MIT
 * http://adamwdraper.github.com/Numeral-js/
 */(function(n){(function(e,s){n.exports?n.exports=s():e.numeral=s()})(ri,function(){var e,s,r="2.0.6",u={},p={},v={currentLocale:"en",zeroFormat:null,nullFormat:null,defaultFormat:"0,0",scalePercentBy100:!0},S={currentLocale:v.currentLocale,zeroFormat:v.zeroFormat,nullFormat:v.nullFormat,defaultFormat:v.defaultFormat,scalePercentBy100:v.scalePercentBy100};function B(d,A){this._input=d,this._value=A}return e=function(d){var A,L,C,y;if(e.isNumeral(d))A=d.value();else if(d===0||typeof d>"u")A=0;else if(d===null||s.isNaN(d))A=null;else if(typeof d=="string")if(S.zeroFormat&&d===S.zeroFormat)A=0;else if(S.nullFormat&&d===S.nullFormat||!d.replace(/[^0-9]+/g,"").length)A=null;else{for(L in u)if(y=typeof u[L].regexps.unformat=="function"?u[L].regexps.unformat():u[L].regexps.unformat,y&&d.match(y)){C=u[L].unformat;break}C=C||e._.stringToNumber,A=C(d)}else A=Number(d)||null;return new B(d,A)},e.version=r,e.isNumeral=function(d){return d instanceof B},e._=s={numberToFormat:function(d,A,L){var C=p[e.options.currentLocale],y=!1,O=!1,q=0,k="",z=1e12,F=1e9,f=1e6,E=1e3,G="",me=!1,X,ee,a,te,Ke,Ve,se;if(d=d||0,ee=Math.abs(d),e._.includes(A,"(")?(y=!0,A=A.replace(/[\(|\)]/g,"")):(e._.includes(A,"+")||e._.includes(A,"-"))&&(Ke=e._.includes(A,"+")?A.indexOf("+"):d<0?A.indexOf("-"):-1,A=A.replace(/[\+|\-]/g,"")),e._.includes(A,"a")&&(X=A.match(/a(k|m|b|t)?/),X=X?X[1]:!1,e._.includes(A," a")&&(k=" "),A=A.replace(new RegExp(k+"a[kmbt]?"),""),ee>=z&&!X||X==="t"?(k+=C.abbreviations.trillion,d=d/z):ee<z&&ee>=F&&!X||X==="b"?(k+=C.abbreviations.billion,d=d/F):ee<F&&ee>=f&&!X||X==="m"?(k+=C.abbreviations.million,d=d/f):(ee<f&&ee>=E&&!X||X==="k")&&(k+=C.abbreviations.thousand,d=d/E)),e._.includes(A,"[.]")&&(O=!0,A=A.replace("[.]",".")),a=d.toString().split(".")[0],te=A.split(".")[1],Ve=A.indexOf(","),q=(A.split(".")[0].split(",")[0].match(/0/g)||[]).length,te?(e._.includes(te,"[")?(te=te.replace("]",""),te=te.split("["),G=e._.toFixed(d,te[0].length+te[1].length,L,te[1].length)):G=e._.toFixed(d,te.length,L),a=G.split(".")[0],e._.includes(G,".")?G=C.delimiters.decimal+G.split(".")[1]:G="",O&&Number(G.slice(1))===0&&(G="")):a=e._.toFixed(d,0,L),k&&!X&&Number(a)>=1e3&&k!==C.abbreviations.trillion)switch(a=String(Number(a)/1e3),k){case C.abbreviations.thousand:k=C.abbreviations.million;break;case C.abbreviations.million:k=C.abbreviations.billion;break;case C.abbreviations.billion:k=C.abbreviations.trillion;break}if(e._.includes(a,"-")&&(a=a.slice(1),me=!0),a.length<q)for(var Ie=q-a.length;Ie>0;Ie--)a="0"+a;return Ve>-1&&(a=a.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+C.delimiters.thousands)),A.indexOf(".")===0&&(a=""),se=a+G+(k||""),y?se=(y&&me?"(":"")+se+(y&&me?")":""):Ke>=0?se=Ke===0?(me?"-":"+")+se:se+(me?"-":"+"):me&&(se="-"+se),se},stringToNumber:function(d){var A=p[S.currentLocale],L=d,C={thousand:3,million:6,billion:9,trillion:12},y,O,q;if(S.zeroFormat&&d===S.zeroFormat)O=0;else if(S.nullFormat&&d===S.nullFormat||!d.replace(/[^0-9]+/g,"").length)O=null;else{O=1,A.delimiters.decimal!=="."&&(d=d.replace(/\./g,"").replace(A.delimiters.decimal,"."));for(y in C)if(q=new RegExp("[^a-zA-Z]"+A.abbreviations[y]+"(?:\\)|(\\"+A.currency.symbol+")?(?:\\))?)?$"),L.match(q)){O*=Math.pow(10,C[y]);break}O*=(d.split("-").length+Math.min(d.split("(").length-1,d.split(")").length-1))%2?1:-1,d=d.replace(/[^0-9\.]+/g,""),O*=Number(d)}return O},isNaN:function(d){return typeof d=="number"&&isNaN(d)},includes:function(d,A){return d.indexOf(A)!==-1},insert:function(d,A,L){return d.slice(0,L)+A+d.slice(L)},reduce:function(d,A){if(this===null)throw new TypeError("Array.prototype.reduce called on null or undefined");if(typeof A!="function")throw new TypeError(A+" is not a function");var L=Object(d),C=L.length>>>0,y=0,O;if(arguments.length===3)O=arguments[2];else{for(;y<C&&!(y in L);)y++;if(y>=C)throw new TypeError("Reduce of empty array with no initial value");O=L[y++]}for(;y<C;y++)y in L&&(O=A(O,L[y],y,L));return O},multiplier:function(d){var A=d.toString().split(".");return A.length<2?1:Math.pow(10,A[1].length)},correctionFactor:function(){var d=Array.prototype.slice.call(arguments);return d.reduce(function(A,L){var C=s.multiplier(L);return A>C?A:C},1)},toFixed:function(d,A,L,C){var y=d.toString().split("."),O=A-(C||0),q,k,z,F;return y.length===2?q=Math.min(Math.max(y[1].length,O),A):q=O,z=Math.pow(10,q),F=(L(d+"e+"+q)/z).toFixed(q),C>A-q&&(k=new RegExp("\\.?0{1,"+(C-(A-q))+"}$"),F=F.replace(k,"")),F}},e.options=S,e.formats=u,e.locales=p,e.locale=function(d){return d&&(S.currentLocale=d.toLowerCase()),S.currentLocale},e.localeData=function(d){if(!d)return p[S.currentLocale];if(d=d.toLowerCase(),!p[d])throw new Error("Unknown locale : "+d);return p[d]},e.reset=function(){for(var d in v)S[d]=v[d]},e.zeroFormat=function(d){S.zeroFormat=typeof d=="string"?d:null},e.nullFormat=function(d){S.nullFormat=typeof d=="string"?d:null},e.defaultFormat=function(d){S.defaultFormat=typeof d=="string"?d:"0.0"},e.register=function(d,A,L){if(A=A.toLowerCase(),this[d+"s"][A])throw new TypeError(A+" "+d+" already registered.");return this[d+"s"][A]=L,L},e.validate=function(d,A){var L,C,y,O,q,k,z,F;if(typeof d!="string"&&(d+="",console.warn&&console.warn("Numeral.js: Value is not string. It has been co-erced to: ",d)),d=d.trim(),d.match(/^\d+$/))return!0;if(d==="")return!1;try{z=e.localeData(A)}catch{z=e.localeData(e.locale())}return y=z.currency.symbol,q=z.abbreviations,L=z.delimiters.decimal,z.delimiters.thousands==="."?C="\\.":C=z.delimiters.thousands,F=d.match(/^[^\d]+/),F!==null&&(d=d.substr(1),F[0]!==y)||(F=d.match(/[^\d]+$/),F!==null&&(d=d.slice(0,-1),F[0]!==q.thousand&&F[0]!==q.million&&F[0]!==q.billion&&F[0]!==q.trillion))?!1:(k=new RegExp(C+"{2}"),d.match(/[^\d.,]/g)?!1:(O=d.split(L),O.length>2?!1:O.length<2?!!O[0].match(/^\d+.*\d$/)&&!O[0].match(k):O[0].length===1?!!O[0].match(/^\d+$/)&&!O[0].match(k)&&!!O[1].match(/^\d+$/):!!O[0].match(/^\d+.*\d$/)&&!O[0].match(k)&&!!O[1].match(/^\d+$/)))},e.fn=B.prototype={clone:function(){return e(this)},format:function(d,A){var L=this._value,C=d||S.defaultFormat,y,O,q;if(A=A||Math.round,L===0&&S.zeroFormat!==null)O=S.zeroFormat;else if(L===null&&S.nullFormat!==null)O=S.nullFormat;else{for(y in u)if(C.match(u[y].regexps.format)){q=u[y].format;break}q=q||e._.numberToFormat,O=q(L,C,A)}return O},value:function(){return this._value},input:function(){return this._input},set:function(d){return this._value=Number(d),this},add:function(d){var A=s.correctionFactor.call(null,this._value,d);function L(C,y,O,q){return C+Math.round(A*y)}return this._value=s.reduce([this._value,d],L,0)/A,this},subtract:function(d){var A=s.correctionFactor.call(null,this._value,d);function L(C,y,O,q){return C-Math.round(A*y)}return this._value=s.reduce([d],L,Math.round(this._value*A))/A,this},multiply:function(d){function A(L,C,y,O){var q=s.correctionFactor(L,C);return Math.round(L*q)*Math.round(C*q)/Math.round(q*q)}return this._value=s.reduce([this._value,d],A,1),this},divide:function(d){function A(L,C,y,O){var q=s.correctionFactor(L,C);return Math.round(L*q)/Math.round(C*q)}return this._value=s.reduce([this._value,d],A),this},difference:function(d){return Math.abs(e(this._value).subtract(d).value())}},e.register("locale","en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(d){var A=d%10;return~~(d%100/10)===1?"th":A===1?"st":A===2?"nd":A===3?"rd":"th"},currency:{symbol:"$"}}),function(){e.register("format","bps",{regexps:{format:/(BPS)/,unformat:/(BPS)/},format:function(d,A,L){var C=e._.includes(A," BPS")?" ":"",y;return d=d*1e4,A=A.replace(/\s?BPS/,""),y=e._.numberToFormat(d,A,L),e._.includes(y,")")?(y=y.split(""),y.splice(-1,0,C+"BPS"),y=y.join("")):y=y+C+"BPS",y},unformat:function(d){return+(e._.stringToNumber(d)*1e-4).toFixed(15)}})}(),function(){var d={base:1e3,suffixes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]},A={base:1024,suffixes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},L=d.suffixes.concat(A.suffixes.filter(function(y){return d.suffixes.indexOf(y)<0})),C=L.join("|");C="("+C.replace("B","B(?!PS)")+")",e.register("format","bytes",{regexps:{format:/([0\s]i?b)/,unformat:new RegExp(C)},format:function(y,O,q){var k,z=e._.includes(O,"ib")?A:d,F=e._.includes(O," b")||e._.includes(O," ib")?" ":"",f,E,G;for(O=O.replace(/\s?i?b/,""),f=0;f<=z.suffixes.length;f++)if(E=Math.pow(z.base,f),G=Math.pow(z.base,f+1),y===null||y===0||y>=E&&y<G){F+=z.suffixes[f],E>0&&(y=y/E);break}return k=e._.numberToFormat(y,O,q),k+F},unformat:function(y){var O=e._.stringToNumber(y),q,k;if(O){for(q=d.suffixes.length-1;q>=0;q--){if(e._.includes(y,d.suffixes[q])){k=Math.pow(d.base,q);break}if(e._.includes(y,A.suffixes[q])){k=Math.pow(A.base,q);break}}O*=k||1}return O}})}(),function(){e.register("format","currency",{regexps:{format:/(\$)/},format:function(d,A,L){var C=e.locales[e.options.currentLocale],y={before:A.match(/^([\+|\-|\(|\s|\$]*)/)[0],after:A.match(/([\+|\-|\)|\s|\$]*)$/)[0]},O,q,k;for(A=A.replace(/\s?\$\s?/,""),O=e._.numberToFormat(d,A,L),d>=0?(y.before=y.before.replace(/[\-\(]/,""),y.after=y.after.replace(/[\-\)]/,"")):d<0&&!e._.includes(y.before,"-")&&!e._.includes(y.before,"(")&&(y.before="-"+y.before),k=0;k<y.before.length;k++)switch(q=y.before[k],q){case"$":O=e._.insert(O,C.currency.symbol,k);break;case" ":O=e._.insert(O," ",k+C.currency.symbol.length-1);break}for(k=y.after.length-1;k>=0;k--)switch(q=y.after[k],q){case"$":O=k===y.after.length-1?O+C.currency.symbol:e._.insert(O,C.currency.symbol,-(y.after.length-(1+k)));break;case" ":O=k===y.after.length-1?O+" ":e._.insert(O," ",-(y.after.length-(1+k)+C.currency.symbol.length-1));break}return O}})}(),function(){e.register("format","exponential",{regexps:{format:/(e\+|e-)/,unformat:/(e\+|e-)/},format:function(d,A,L){var C,y=typeof d=="number"&&!e._.isNaN(d)?d.toExponential():"0e+0",O=y.split("e");return A=A.replace(/e[\+|\-]{1}0/,""),C=e._.numberToFormat(Number(O[0]),A,L),C+"e"+O[1]},unformat:function(d){var A=e._.includes(d,"e+")?d.split("e+"):d.split("e-"),L=Number(A[0]),C=Number(A[1]);C=e._.includes(d,"e-")?C*=-1:C;function y(O,q,k,z){var F=e._.correctionFactor(O,q),f=O*F*(q*F)/(F*F);return f}return e._.reduce([L,Math.pow(10,C)],y,1)}})}(),function(){e.register("format","ordinal",{regexps:{format:/(o)/},format:function(d,A,L){var C=e.locales[e.options.currentLocale],y,O=e._.includes(A," o")?" ":"";return A=A.replace(/\s?o/,""),O+=C.ordinal(d),y=e._.numberToFormat(d,A,L),y+O}})}(),function(){e.register("format","percentage",{regexps:{format:/(%)/,unformat:/(%)/},format:function(d,A,L){var C=e._.includes(A," %")?" ":"",y;return e.options.scalePercentBy100&&(d=d*100),A=A.replace(/\s?\%/,""),y=e._.numberToFormat(d,A,L),e._.includes(y,")")?(y=y.split(""),y.splice(-1,0,C+"%"),y=y.join("")):y=y+C+"%",y},unformat:function(d){var A=e._.stringToNumber(d);return e.options.scalePercentBy100?A*.01:A}})}(),function(){e.register("format","time",{regexps:{format:/(:)/,unformat:/(:)/},format:function(d,A,L){var C=Math.floor(d/60/60),y=Math.floor((d-C*60*60)/60),O=Math.round(d-C*60*60-y*60);return C+":"+(y<10?"0"+y:y)+":"+(O<10?"0"+O:O)},unformat:function(d){var A=d.split(":"),L=0;return A.length===3?(L=L+Number(A[0])*60*60,L=L+Number(A[1])*60,L=L+Number(A[2])):A.length===2&&(L=L+Number(A[0])*60,L=L+Number(A[1])),Number(L)}})}(),e})})(zn);var oi=zn.exports;const fn=si(oi),de=768,jn=de/2,Hn=10,Re=[1,2,5],ai=[5,4,5],Yn=Re[1],Pn=0,Un=150;let U={x:jn,y:jn,exp:Pn,mant:Yn,size:Un};const li=()=>{U={x:de/2,y:de/2,exp:Pn,mant:Yn,size:Un}},Be=document.getElementById("app");Be==null||Be.addEventListener("wheel",n=>{const e=U,s=n.deltaY<0?Hn:-Hn;if(e.x=U.x+(U.x-n.pageX)*s/U.size,e.y=U.y+(U.y-n.pageY)*s/U.size,e.size=U.size+s,e.size<=100){let r=Re.findIndex(u=>u==e.mant);r++,r>2?(r=0,e.exp++,e.size=2*e.size):e.size=Re[r]*e.size/Re[r-1],e.mant=Re[r]}if(e.size>=200){let r=Re.findIndex(u=>u==e.mant);r--,r<0?(r=2,e.exp--,e.size=e.size/2):e.size=Re[r]*e.size/Re[r+1],e.mant=Re[r]}Math.ceil(-e.x/e.size),Math.floor(e.y/e.size),U=e});let dn=0,pn=0,An=!1;Be==null||Be.addEventListener("mousedown",n=>{dn=n.pageX,pn=n.pageY,An=!0});Be==null||Be.addEventListener("mouseup",n=>{An=!1});Be==null||Be.addEventListener("mousemove",n=>{if(!An)return;const e=n.pageX-dn,s=n.pageY-pn;dn=n.pageX,pn=n.pageY,U.x+=e,U.y+=s});const ci=()=>{const n=document.getElementById("calculator-back"),e=n==null?void 0:n.getContext("2d");if(!e)throw Error("There are no canvas to draw the background on");e.clearRect(0,0,de,de),e.lineWidth=2,e.strokeStyle="#F4F4ED",e.beginPath(),e.moveTo(0,U.y-1),e.lineTo(de,U.y-1),e.stroke(),e.moveTo(U.x-1,0),e.lineTo(U.x-1,de),e.stroke(),Qn(e,U.x,!1,ui,(s,r)=>{e.strokeStyle=Gn("#F4F4ED",r),e.beginPath(),e.moveTo(s,0),e.lineTo(s,de),e.stroke()}),Qn(e,U.y,!0,hi,(s,r)=>{e.strokeStyle=Gn("#F4F4ED",r),e.beginPath(),e.moveTo(0,s),e.lineTo(de,s),e.stroke()})};function Qn(n,e,s,r,u){n.lineWidth=1;const p=ai[Re.findIndex(A=>A==U.mant)],v=U.size/p,S=Math.ceil(-e/v);let B=S*v,d=Math.floor((S-1)/p+1)*U.mant;for(s&&(d=-d);e+B<=de;){const A=e+B;if(Math.abs(B%U.size)<1){const L=di(d,U.exp);d!=0&&(r(n,L,A),u(A,.65)),d+=s?-U.mant:U.mant}else{const L=Math.max(0,(v-20)*.01);u(A,L)}B+=v}}function ui(n,e,s){const r=n.measureText(e);let u="#F4F4ED";n.font="18px sans-serif";let p=s-r.width/2;p<5?(p=5,u="#babaab"):p>de-5-r.width&&(p=de-5-r.width,u="#babaab");let v=U.y+20;v<25?(v=25,u="#babaab"):v>de-5&&(v=de-5,u="#babaab"),n.fillStyle="rgba(15, 15, 15, 50%)",n.fillRect(p,v-18,r.width,20),n.fillStyle=u,n.fillText(e,p,v)}function hi(n,e,s){const r=n.measureText(e);let u="#F4F4ED";n.font="18px sans-serif";let p=U.x-r.width-10;p<5?(p=5,u="#babaab"):p>de-5-r.width&&(p=de-5-r.width,u="#babaab");let v=s+6;v<20?(v=20,u="#babaab"):v>de-5&&(v=de-5,u="#babaab"),n.fillStyle="rgba(15, 15, 15, 50%)",n.fillRect(p,v,r.width,20),n.fillStyle=u,n.fillText(e,p,v)}const fi=[8304,185,178,179,8308,8309,8310,8311,8312,8313];function di(n,e){const r=fn(n).format("0.0000e+0").split("e"),u=parseFloat(r[0]?r[0]:"0"),p=parseInt(r[1]?r[1]:"0")+e;if(p>-5&&p<7){let B=u*Math.pow(10,p);return fn(B).format("0[.][000000]")}const v=[...p.toString()].map(B=>{if(B=="-")return"⁻";const d=fi[(B.charCodeAt(0)-48)%10];return d?String.fromCharCode(d):""}).toString().replace(",","");return u+"·10"+v}function Gn(n,e){const s=parseInt(n.slice(1,3),16),r=parseInt(n.slice(3,5),16),u=parseInt(n.slice(5,7),16);return"rgba("+s+", "+r+", "+u+", "+e+")"}async function pi(n,e){return{code:"ret.x = fneg(x - y);",num:void 0}}async function mi(n,e,s){throw Error("TODO")}async function bi(n){throw Error("TODO")}async function gi(n,e){throw Error("TODO")}async function Ei(n){throw Error("TODO")}var He,Dt,Xn;class Ai{constructor(e){Lt(this,Dt);Lt(this,He,void 0);Ee(this,"html");this.html=document.createElement("div"),this.html.className="expr-variable-bar",_n(this,He,new Map),this.ofArray(e)}ofArray(e){const s=[...et(this,He).keys()].filter(u=>!e.includes(u)),r=e.filter(u=>!et(this,He).has(u));for(const u of s)this.delete(u);for(const u of r)this.add(u)}delete(e){const s=et(this,He).get(e);s==null||s.remove(),et(this,He).delete(e)}add(e){const s=rn(this,Dt,Xn).call(this,e);et(this,He).set(e,s),this.html.appendChild(s)}}He=new WeakMap,Dt=new WeakSet,Xn=function(e){const s=document.createElement("button");return s.className="expr-variable-btn",s.textContent=e,s.onclick=()=>{this.delete(e);const r=Tt.createNew();r.mathField.write(`${e}=`);const u=document.getElementById("sidebar");u==null||u.appendChild(r.htmlElement),r.focus()},s};const vi=MathQuill.getInterface(2),ve=new Map,it=new Map,rt=new Map;var It=(n=>(n[n.ADD=0]="ADD",n[n.REMOVE=1]="REMOVE",n[n.REFRESH=2]="REFRESH",n))(It||{});const yi="sin cos tan sec csc cosec cotan floor abs ceil log ln",wi="pi theta sqrt sum rho phi lambda",xi={spaceBehavesLikeTab:!0,autoCommands:wi,autoOperatorNames:yi,handlers:null};var Rt,Kn;const Et=class Et{constructor(e,s){Lt(this,Rt);Ee(this,"number");Ee(this,"color");Ee(this,"drawable",!1);Ee(this,"visible",!0);Ee(this,"error",!1);Ee(this,"htmlElement");Ee(this,"mathField");Ee(this,"oldLatex");Ee(this,"solutionBox");Ee(this,"undefVarsBar");Ee(this,"code");Ee(this,"close",async()=>{const e=this.functionCharacter(),s=this.variableCharacter();e&&(Ji(e,this),it.delete(e)),s&&(tr(s,this),rt.delete(s)),this.htmlElement.remove(),ve.delete(this.number)});Ee(this,"refresh",async()=>{const e=this.mathField.latex();let s;this.oldLatex.length<e.length?s=0:this.oldLatex==e?s=2:s=1,this.oldLatex=e,await Wi(this.number,e,s)});this.number=e,this.color=`hsl(${s} 69% 69%)`,this.oldLatex="",this.undefVarsBar=new Ai([]),this.htmlElement=rn(this,Rt,Kn).call(this)}static createNew(){const e=new Et(this.currNumber,this.currHue);ve.set(this.currNumber,e);const s=xi;return s.handlers={edit:e.refresh},e.mathField.config(s),this.currNumber++,this.currHue=(this.currHue+49)%360,e}focus(){this.mathField.focus()}toggleError(){const e=this.htmlElement.querySelector(".expr-button"),s=e==null?void 0:e.getElementsByTagName("i");if(s)for(let r of s)r.remove();this.error&&(e==null||e.insertAdjacentHTML("beforeend",`<i class="fa-solid fa-triangle-exclamation ${this.visible?"error-box":"error-box-inverted"}"></i>`))}writeError(e){const s=this.htmlElement.querySelector(".expr-button");this.error=!0;const r=s==null?void 0:s.getElementsByTagName("i");if(r)for(let u of r)u.remove();s==null||s.insertAdjacentHTML("beforeend",`<i class="fa-solid fa-triangle-exclamation ${this.visible?"error-box":"error-box-inverted"}" title="${e}"></i>`)}functionCharacter(){const e=this.mathField.latex().match("[A-Za-z]\\\\left\\([x-y]\\\\right\\)=");if(!e)return null;const s=e[0][0];if("xye".includes(s))throw Error(`A function can't be named ${s}, it's a reserved character`);if(rt.has(s))throw Error(`There is already a variable with that name: ${s}`);return s}variableCharacter(){const e=this.mathField.latex().match("[A-Za-z]=");if(!e)return null;const s=e[0][0];if("xy".includes(s))return null;if(s=="e")throw Error("A variable can't be named e");if(it.has(s))throw Error(`There's already a function with that name ${s}`);return s}getVariables(){const e=this.functionCharacter(),s=this.variableCharacter(),r=Array.from(this.htmlElement.getElementsByTagName("var")).filter(u=>!u.classList.contains("mq-operator-name")).map(u=>u.textContent).flatMap(u=>u||[]).filter(u=>!it.has(u));return(e||s)&&r.splice(0,1),new Set(r)}writeFunctionBrackets(){var r;const e=this.htmlElement.querySelector(".mq-cursor"),s=e==null?void 0:e.previousElementSibling;s&&s.classList.contains("mq-operator-name")&&((r=this.mathField)==null||r.typedText("("))}setSolutionValue(e){if(!this.solutionBox)throw Error("No solution box");this.solutionBox.style.display="inline",e>0&&e<1e-6&&(e=0),this.solutionBox.textContent=fn(e).format("0[.][000000]")}hideSolutionBox(){if(!this.solutionBox)throw Error("No solution box");this.solutionBox.style.display="none"}showUndefinedVariables(e){const s=[...e].filter(r=>!rt.has(r)).filter(r=>!"xye".includes(r));return this.undefVarsBar.ofArray(s),s.length}setDrawable(e){const s=this.htmlElement.querySelector(".expr-button");e?(s.style.background=this.color,s.style.boxShadow="0px 0px 5px 3px "+this.color,s.addEventListener("click",()=>{this.visible=!this.visible,s.style.background=this.visible?this.color:"#1d1d1d",this.toggleError()})):(this.visible=!1,s.onclick=()=>{},s.style.background="transparent",s.style.boxShadow="none"),this.drawable=e}};Rt=new WeakSet,Kn=function(){this.htmlElement=document.createElement("div"),this.htmlElement.className="expr",this.htmlElement.id="eq-bar-"+this.number;const e=document.createElement("div");e.className="expr-container";const s=document.createElement("div");s.className="expr-button",s.id="expr-button-"+this.number,e.append(s);const r=document.createElement("span");r.className="math-field",this.mathField=vi.MathField(r),e.append(r);const u=document.createElement("button");u.insertAdjacentHTML("beforeend",'<span><i class="fa-solid fa-xmark"></i></span>'),u.className="close-button",u.addEventListener("click",this.close),e.append(u),this.htmlElement.append(e);const p=document.createElement("div");return p.className="expr-bottom",this.solutionBox=document.createElement("span"),this.solutionBox.className="solution-box",p==null||p.appendChild(this.solutionBox),this.hideSolutionBox(),p.append(this.undefVarsBar.html),this.htmlElement.append(p),this.htmlElement},Ee(Et,"currNumber",0),Ee(Et,"currHue",0);let Tt=Et;var _,qe,Z,qt;(function(n){n.HEX="HEX",n.RGB="RGB",n.HSL="HSL",n.CIELab="CIELab",n.CMYK="CMYK"})(_||(_={})),function(n){n.ANALOGOUS="ANALOGOUS",n.COMPLEMENTARY="COMPLEMENTARY",n.SPLIT_COMPLEMENTARY="SPLIT_COMPLEMENTARY",n.TRIADIC="TRIADIC",n.TETRADIC="TETRADIC",n.SQUARE="SQUARE"}(qe||(qe={})),function(n){n.ADDITIVE="ADDITIVE",n.SUBTRACTIVE="SUBTRACTIVE"}(Z||(Z={})),function(n){n.black="#000000",n.silver="#C0C0C0",n.gray="#808080",n.white="#FFFFFF",n.maroon="#800000",n.red="#FF0000",n.purple="#800080",n.fuchsia="#FF00FF",n.green="#008000",n.lime="#00FF00",n.olive="#808000",n.yellow="#FFFF00",n.navy="#000080",n.blue="#0000FF",n.teal="#008080",n.aqua="#00FFFF",n.orange="#FFA500",n.aliceblue="#F0F8FF",n.antiquewhite="#FAEBD7",n.aquamarine="#7FFFD4",n.azure="#F0FFFF",n.beige="#F5F5DC",n.bisque="#FFE4C4",n.blanchedalmond="#FFEBCD",n.blueviolet="#8A2BE2",n.brown="#A52A2A",n.burlywood="#DEB887",n.cadetblue="#5F9EA0",n.chartreuse="#7FFF00",n.chocolate="#D2691E",n.coral="#FF7F50",n.cornflowerblue="#6495ED",n.cornsilk="#FFF8DC",n.crimson="#DC143C",n.cyan="#00FFFF",n.darkblue="#00008B",n.darkcyan="#008B8B",n.darkgoldenrod="#B8860B",n.darkgray="#A9A9A9",n.darkgreen="#006400",n.darkgrey="#A9A9A9",n.darkkhaki="#BDB76B",n.darkmagenta="#8B008B",n.darkolivegreen="#556B2F",n.darkorange="#FF8C00",n.darkorchid="#9932CC",n.darkred="#8B0000",n.darksalmon="#E9967A",n.darkseagreen="#8FBC8F",n.darkslateblue="#483D8B",n.darkslategray="#2F4F4F",n.darkslategrey="#2F4F4F",n.darkturquoise="#00CED1",n.darkviolet="#9400D3",n.deeppink="#FF1493",n.deepskyblue="#00BFFF",n.dimgray="#696969",n.dimgrey="#696969",n.dodgerblue="#1E90FF",n.firebrick="#B22222",n.floralwhite="#FFFAF0",n.forestgreen="#228B22",n.gainsboro="#DCDCDC",n.ghostwhite="#F8F8FF",n.gold="#FFD700",n.goldenrod="#DAA520",n.greenyellow="#ADFF2F",n.grey="#808080",n.honeydew="#F0FFF0",n.hotpink="#FF69B4",n.indianred="#CD5C5C",n.indigo="#4B0082",n.ivory="#FFFFF0",n.khaki="#F0E68C",n.lavender="#E6E6FA",n.lavenderblush="#FFF0F5",n.lawngreen="#7CFC00",n.lemonchiffon="#FFFACD",n.lightblue="#ADD8E6",n.lightcoral="#F08080",n.lightcyan="#E0FFFF",n.lightgoldenrodyellow="#FAFAD2",n.lightgray="#D3D3D3",n.lightgreen="#90EE90",n.lightgrey="#D3D3D3",n.lightpink="#FFB6C1",n.lightsalmon="#FFA07A",n.lightseagreen="#20B2AA",n.lightskyblue="#87CEFA",n.lightslategray="#778899",n.lightslategrey="#778899",n.lightsteelblue="#B0C4DE",n.lightyellow="#FFFFE0",n.limegreen="#32CD32",n.linen="#FAF0E6",n.magenta="#FF00FF",n.mediumaquamarine="#66CDAA",n.mediumblue="#0000CD",n.mediumorchid="#BA55D3",n.mediumpurple="#9370DB",n.mediumseagreen="#3CB371",n.mediumslateblue="#7B68EE",n.mediumspringgreen="#00FA9A",n.mediumturquoise="#48D1CC",n.mediumvioletred="#C71585",n.midnightblue="#191970",n.mintcream="#F5FFFA",n.mistyrose="#FFE4E1",n.moccasin="#FFE4B5",n.navajowhite="#FFDEAD",n.oldlace="#FDF5E6",n.olivedrab="#6B8E23",n.orangered="#FF4500",n.orchid="#DA70D6",n.palegoldenrod="#EEE8AA",n.palegreen="#98FB98",n.paleturquoise="#AFEEEE",n.palevioletred="#DB7093",n.papayawhip="#FFEFD5",n.peachpuff="#FFDAB9",n.peru="#CD853F",n.pink="#FFC0CB",n.plum="#DDA0DD",n.powderblue="#B0E0E6",n.rosybrown="#BC8F8F",n.royalblue="#4169E1",n.saddlebrown="#8B4513",n.salmon="#FA8072",n.sandybrown="#F4A460",n.seagreen="#2E8B57",n.seashell="#FFF5EE",n.sienna="#A0522D",n.skyblue="#87CEEB",n.slateblue="#6A5ACD",n.slategray="#708090",n.slategrey="#708090",n.snow="#FFFAFA",n.springgreen="#00FF7F",n.steelblue="#4682B4",n.tan="#D2B48C",n.thistle="#D8BFD8",n.tomato="#FF6347",n.turquoise="#40E0D0",n.violet="#EE82EE",n.wheat="#F5DEB3",n.whitesmoke="#F5F5F5",n.yellowgreen="#9ACD32",n.rebeccapurple="#663399"}(qt||(qt={}));const Vn=Object.keys(qt),Ci={HEX:["R","G","B","A"],RGB:["R","G","B","A"],HSL:["H","S","L","A"],CIELab:["L","a","b","A"],CMYK:["C","M","Y","K","A"]},mn={BGR:_.RGB,ABGR:_.RGB,HLS:_.HSL,AHLS:_.HSL,LAB:_.CIELab,ALAB:_.CIELab,CKMY:_.CMYK,ACKMY:_.CMYK};var gt;(function(n){n.NUMBER="number",n.BOOLEAN="boolean"})(gt||(gt={}));const Le={[_.HEX]:/^#(?:([a-f\d])([a-f\d])([a-f\d])([a-f\d])?|([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?)$/i,[_.RGB]:/^rgba?\s*\(\s*(?:((?:\d*\.)?\d+%?)\s*,\s*((?:\d*\.)?\d+%?)\s*,\s*((?:\d*\.)?\d+%?)(?:\s*,\s*((?:\d*\.)?\d+))?|((?:\d*\.)?\d+%?)\s*((?:\d*\.)?\d+%?)\s*((?:\d*\.)?\d+%?)(?:\s*\/\s*((?:\d*\.)?\d+%?))?)\s*\)$/,[_.HSL]:/^hsla?\s*\(\s*(?:(-?(?:\d*\.)?\d+(?:deg|grad|rad|turn)?)\s*,\s*((?:\d*\.)?\d+)%\s*,\s*((?:\d*\.)?\d+)%(?:\s*,\s*((?:\d*\.)?\d+))?|(-?(?:\d*\.)?\d+(?:deg|grad|rad|turn)?)\s*((?:\d*\.)?\d+)%\s*((?:\d*\.)?\d+)%(?:\s*\/\s*((?:\d*\.)?\d+%?))?)\s*\)$/,[_.CIELab]:/^lab\s*\(\s*(?:((?:\d*\.)?\d+%?)\s*(-?(?:\d*\.)?\d+%?)\s*(-?(?:\d*\.)?\d+%?)(?:\s*\/\s*((?:\d*\.)?\d+%?))?)\s*\)$/,[_.CMYK]:/^(?:device-cmyk|cmyk)\s*\(\s*(?:((?:\d*\.)?\d+%?)\s*,\s*((?:\d*\.)?\d+%?)\s*,\s*((?:\d*\.)?\d+%?)\s*,\s*((?:\d*\.)?\d+%?)(?:\s*,\s*((?:\d*\.)?\d+))?|((?:\d*\.)?\d+%?)\s*((?:\d*\.)?\d+%?)\s*((?:\d*\.)?\d+%?)\s*((?:\d*\.)?\d+%?)(?:\s*\/\s*((?:\d*\.)?\d+%?))?)\s*\)$/},Wn=/^(-?(?:\d*\.)?\d+)((?:deg|grad|rad|turn)?)$/,ce=/^(-?\d+(?:\.\d+)?|-?\.\d+)%$/,bn=/^0x([a-f\d]{1,2})$/i,Li=/\{(\d+)\}/g,Si=/,( +|\d+)/g,Oi=/ +/,Fi="The provided string color doesn't have a correct format",Bi="The provided color object doesn't have the proper keys or format";var xe,ye,At;(function(n){n.NONE="none",n.DEGREES="deg",n.GRADIANS="grad",n.RADIANS="rad",n.TURNS="turn"})(xe||(xe={})),function(n){n.NONE="none",n.PERCENT="percent"}(ye||(ye={})),function(n){n.DEVICE_CMYK="device-cmyk",n.CMYK="cmyk"}(At||(At={}));const je={decimals:6,legacyCSS:!1,spacesAfterCommas:!1,anglesUnit:xe.NONE,rgbUnit:ye.NONE,labUnit:ye.NONE,cmykUnit:ye.PERCENT,alphaUnit:ye.NONE,cmykFunction:At.DEVICE_CMYK},pe=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),yt=n=>+`${n}`.replace(ce,"$1"),Ue=n=>ce.test(`${n}`)?yt(n):Math.min(+n,100),St=n=>(n.length===1&&(n+=n),parseInt(n,16)),Ot=n=>{const e=R(n,0).toString(16).toUpperCase();return e.length===1?`0x0${e}`:`0x${e}`},Pe=(n,e=!1)=>!e&&ce.test(n)?Math.min(255*yt(n)/100,255):bn.test(n)?(n.length===3&&(n+=n.slice(-1)),e?R(n)/255:R(n)):Math.min(+n,e?1:255),kt=n=>ce.test(n)?he(125*yt(n)/100,-125,125):he(+n,-125,125),$e=n=>Math.min(ce.test(n)?yt(n)/100:+n,1),Zn=n=>[...n].sort().join("").toUpperCase(),R=(n,e=6)=>{const s=Math.pow(10,e);return Math.round(+n*s)/s},he=(n,e,s)=>Math.max(e,Math.min(n,s)),vt=n=>{if(typeof n=="string"){const e=n.match(Wn),s=+e[1];switch(e[2]){case xe.RADIANS:n=R(180*s/Math.PI);break;case xe.TURNS:n=R(360*s);break;case xe.GRADIANS:n=R(.9*s);break;case xe.DEGREES:default:n=s}}return(n>360||n<0)&&(n-=360*Math.floor(n/360)),n},Ti=(n,e)=>{let s;switch(e){case xe.RADIANS:s=R((r=>r*Math.PI/180)(n));break;case xe.TURNS:s=R(n/360);break;case xe.GRADIANS:s=R(10/9*n);break;case xe.DEGREES:case xe.NONE:default:s=n}return s},H=(n,...e)=>{const s=[],r=[],u=[],p=[],v=[],S=[],B=Object.values(xe),d=Object.values(ye),A=Object.values(At),L={legacyCSS:0,spacesAfterCommas:0,cmykFunction:0};for(const C of e)if(typeof C=="string"){if(s.push(C),C.includes(",")){L.legacyCSS++;const y=C.match(Si);new Set(y).size===1&&Oi.test(y[0].slice(1))&&L.spacesAfterCommas++}if(C.match(Le.HSL)){const y=C.match(Le.HSL),O=y[1]||y[5],q=y[8],k=O.match(Wn)[2];r.push(k===""?xe.NONE:k),S.push(ce.test(q));continue}if(Le.RGB.test(C)){const y=C.match(Le.RGB),O=y[1]||y[5],q=y[2]||y[6],k=y[3]||y[7],z=y[8];u.push(ce.test(O)&&ce.test(q)&&ce.test(k)),S.push(ce.test(z));continue}if(Le.CIELab.test(C)){const y=C.match(Le.CIELab),O=y[1],q=y[2],k=y[3],z=y[4];p.push(ce.test(O)&&ce.test(q)&&ce.test(k)),S.push(ce.test(z));continue}if(C.match(Le.CMYK)){const y=C.match(Le.CMYK),O=y[1]||y[6],q=y[2]||y[7],k=y[3]||y[8],z=y[4]||y[9],F=y[10];v.push(ce.test(O)&&ce.test(q)&&ce.test(k)&&ce.test(z)),C.startsWith("cmyk")&&L.cmykFunction++,S.push(ce.test(F))}}return{decimals:typeof n.decimals===gt.NUMBER?n.decimals:je.decimals,legacyCSS:typeof n.legacyCSS===gt.BOOLEAN?n.legacyCSS:!!(s.length&&L.legacyCSS===s.length)||je.legacyCSS,spacesAfterCommas:typeof n.spacesAfterCommas===gt.BOOLEAN?n.spacesAfterCommas:!!(s.length&&L.spacesAfterCommas===s.length)||je.spacesAfterCommas,anglesUnit:n.anglesUnit&&B.includes(n.anglesUnit)?n.anglesUnit:new Set(r).size===1?r[0]:je.anglesUnit,rgbUnit:n.rgbUnit&&d.includes(n.rgbUnit)?n.rgbUnit:new Set(u).size===1&&u[0]?ye.PERCENT:je.rgbUnit,labUnit:n.labUnit&&d.includes(n.labUnit)?n.labUnit:new Set(p).size===1&&p[0]?ye.PERCENT:je.labUnit,cmykUnit:n.cmykUnit&&d.includes(n.cmykUnit)?n.cmykUnit:new Set(v).size!==1||v[0]?je.cmykUnit:ye.NONE,alphaUnit:n.alphaUnit&&d.includes(n.alphaUnit)?n.alphaUnit:new Set(S).size===1&&S[0]?ye.PERCENT:je.alphaUnit,cmykFunction:n.cmykFunction&&A.includes(n.cmykFunction)?n.cmykFunction:v.length&&v.length===L.cmykFunction?At.CMYK:je.cmykFunction}},sn=n=>`${n}`in Z,Jn=[[.4360747,.3850649,.1430804],[.2225045,.7168786,.0606169],[.0139322,.0971045,.7141733]],qi=[[3.1338561,-1.6168667,-.4906146],[-.9787684,1.9161415,.033454],[.0719453,-.2289914,1.4052427]],st=Jn.map(n=>n.reduce((e,s)=>e+s,0)),on=(n,e,s)=>(s<0&&(s+=6),s>=6&&(s-=6),R(s<1?255*((e-n)*s+n):s<3?255*e:s<4?255*((e-n)*(4-s)+n):255*n)),ki=n=>n<=.04045?n/12.92:((n+.055)/1.055)**2.4,Di=n=>n<=.0031308?12.92*n:1.055*n**(1/2.4)-.055,ei=(n,e,s,r)=>{const u=[0,0,0],p=[n,e,s];return r.forEach((v,S)=>{v.forEach((B,d)=>{u[S]+=B*p[d]})}),u},ue=(n,e,s)=>{e/=100;const r=(s/=100)<=.5?s*(e+1):s+e-s*e,u=2*s-r;return{R:on(u,r,(n/=60)+2),G:on(u,r,n),B:on(u,r,n-2)}},ot=(n,e,s,r=1)=>{n/=255,e/=255,s/=255,r=Math.min(r,1);const u=Math.max(n,e,s),p=Math.min(n,e,s),v=u-p;let S=0,B=0;const d=(u+p)/2;if(v!==0){switch(u){case n:S=(e-s)/v%6;break;case e:S=(s-n)/v+2;break;case s:S=(n-e)/v+4}S=R(60*S),S<0&&(S+=360),B=v/(1-Math.abs(2*d-1))}return{H:S,S:R(100*B),L:R(100*d),A:r}},at=(n,e,s)=>{const r=[n/255,e/255,s/255].map(ki),u=ei(r[0],r[1],r[2],Jn),p=((v,S,B)=>{const d=C=>C>.008856451679035631?Math.cbrt(C):C/.12841854934601665+.13793103448275862,A=d(v/st[0]),L=d(S/st[1]);return[116*L-16,500*(A-L),200*(L-d(B/st[2]))]})(u[0],u[1],u[2]);return{L:p[0],a:p[1],b:p[2]}},vn=(n,e,s)=>{const r=((p,v,S)=>{const B=C=>C>.20689655172413793?C**3:.12841854934601665*(C-.13793103448275862),d=(p+16)/116,A=v/500,L=S/200;return[st[0]*B(d+A),st[1]*B(d),st[2]*B(d-L)]})(n,e,s),u=ei(r[0],r[1],r[2],qi).map(Di);return{R:he(255*u[0],0,255),G:he(255*u[1],0,255),B:he(255*u[2],0,255)}},yn=(n,e,s,r)=>({R:R(255*(1-n)*(r=1-r)),G:R(255*(1-e)*r),B:R(255*(1-s)*r)}),ti=(n,e,s)=>{n/=255,e/=255,s/=255;const r=1-Math.max(n,e,s),u=1-r,p=u&&(u-e)/u,v=u&&(u-s)/u;return{C:R(100*(u&&(u-n)/u)),M:R(100*p),Y:R(100*v),K:R(100*r)}},Nn=(n,e)=>{if(n<0&&(n+=360),n>360&&(n-=360),n===360||n===0)return n;const s=[[0,120],[120,180],[180,240],[240,360]],r=[[0,60],[60,120],[120,240],[240,360]],u=e?r:s;let p=0,v=0,S=0,B=0;return(e?s:r).find((d,A)=>n>=d[0]&&n<d[1]&&(p=d[0],v=d[1],S=u[A][0],B=u[A][1],!0)),S+(B-S)/(v-p)*(n-p)},an=n=>n?", ":",",mt=(n,e)=>{const s=Zn(Object.keys(n));return Ci[mn[s]].reduce((r,u,p)=>{const v=n[u];return v!==void 0&&r.push(e(v,p)),r},[])},bt=(n,e)=>n.replace(Li,(s,r)=>`${e[+r-1]}`),Ft=(n,e,s=!1)=>{const{alphaUnit:r,legacyCSS:u,decimals:p}=e;return r!==ye.PERCENT||u&&!s?R(n,p):`${R(100*n,p)}%`},M={[_.HEX]:n=>{const e=mt(n,r=>(u=>{let p=R(u,0).toString(16).toUpperCase();return p.length===1&&(p=`0${p}`),p})(R(r))),s=e.length===4?"#{1}{2}{3}{4}":"#{1}{2}{3}";return bt(s,e)},[_.RGB]:(n,e)=>{const{decimals:s,legacyCSS:r,spacesAfterCommas:u,rgbUnit:p}=e,v=an(u),S=mt(n,(d,A)=>p===ye.PERCENT&&A<3?`${((L,C)=>R(L/255*100,C))(d,s)}%`:A===3?Ft(d,e):R(d,s)),B=r?S.length===4?`rgba({1}${v}{2}${v}{3}${v}{4})`:`rgb({1}${v}{2}${v}{3})`:S.length===4?"rgb({1} {2} {3} / {4})":"rgb({1} {2} {3})";return bt(B,S)},[_.HSL]:(n,e)=>{const{decimals:s,legacyCSS:r,spacesAfterCommas:u,anglesUnit:p}=e,v=an(u),S=mt(n,(d,A)=>A===0&&p!==xe.NONE?`${R(Ti(d,p),s)}${p}`:A===3?Ft(d,e):R(d,s)),B=r?S.length===4?`hsla({1}${v}{2}%${v}{3}%${v}{4})`:`hsl({1}${v}{2}%${v}{3}%)`:S.length===4?"hsl({1} {2}% {3}% / {4})":"hsl({1} {2}% {3}%)";return bt(B,S)},[_.CIELab]:(n,e)=>{const{decimals:s,labUnit:r}=e,u=mt(n,(v,S)=>{if(S===0){const B=R(Ue(v),s);return r===ye.PERCENT?`${B}%`:`${B}`}return S<3?r===ye.PERCENT?`${((B,d)=>R(B/125*100,d))(v,s)}%`:R(v,s):Ft(v,e,!0)}),p=u.length===4?"lab({1} {2} {3} / {4})":"lab({1} {2} {3})";return bt(p,u)},[_.CMYK]:(n,e)=>{const{decimals:s,legacyCSS:r,spacesAfterCommas:u,cmykUnit:p,cmykFunction:v}=e,S=an(u),B=mt(n,(A,L)=>p===ye.PERCENT&&L<4?`${R(A,s)}%`:L===4?Ft(A,e):R(A/100,s)),d=r?B.length===5?`${v}({1}${S}{2}${S}{3}${S}{4}${S}{5})`:`${v}({1}${S}{2}${S}{3}${S}{4})`:B.length===5?`${v}({1} {2} {3} {4} / {5})`:`${v}({1} {2} {3} {4})`;return bt(d,B)}},fe=n=>(typeof n=="string"&&(n=ce.test(n)?yt(n)/100:+n),isNaN(+n)||n>1?1:R(n)),lt=(n,e,s)=>e.reduce((r,u)=>[...r,{...n,H:s===Z.ADDITIVE?vt(n.H+u):vt(Nn(Nn(n.H,!1)+u,!0))}],[{...n}]),Ri=(n,e)=>lt(n,[30,-30],e),Ii=(n,e)=>lt(n,[180],e),Mi=(n,e)=>lt(n,[150,-150],e),_i=(n,e)=>lt(n,[120,-120],e),ji=(n,e)=>lt(n,[60,-120,180],e),Hi=(n,e)=>lt(n,[90,-90,180],e),oe=n=>typeof n=="string"?(e=>{let s;if(Object.keys(_).some(r=>{if(Le[r].test(e))return s=r,!0}),!s&&~Vn.indexOf(e)&&(s=_.HEX),!s)throw new Error(Fi);return s})(n):(e=>{let s,r=!1;const u=Zn(Object.keys(e));if(mn[u]&&(s=mn[u]),s&&s===_.RGB){const p=Object.entries(e).some(S=>!bn.test(`${S[1]}`)),v=Object.entries(e).some(S=>!(ce.test(`${S[1]}`)||!bn.test(`${S[1]}`)&&!isNaN(+S[1])&&+S[1]<=255));p&&v&&(r=!0),p||(s=_.HEX)}if(!s||r)throw new Error(Bi);return s})(n),Qi={[_.HEX](n){const e=(~Vn.indexOf(n)?qt[n]:n).match(Le.HEX),s={R:St(e[1]||e[5]),G:St(e[2]||e[6]),B:St(e[3]||e[7])},r=e[4]||e[8];return r!==void 0&&(s.A=St(r)/255),s},[_.RGB](n){const e=n.match(Le.RGB),s=Pe(e[1]||e[5]),r=Pe(e[2]||e[6]),u=Pe(e[3]||e[7]),p=e[4]||e[8],v={R:Math.min(s,255),G:Math.min(r,255),B:Math.min(u,255)};return p!==void 0&&(v.A=fe(p)),v},[_.HSL](n){const e=n.match(Le.HSL),s=vt(e[1]||e[5]),r=Ue(e[2]||e[6]),u=Ue(e[3]||e[7]),p=e[4]||e[8],v=ue(s,r,u);return p!==void 0&&(v.A=fe(p)),v},[_.CIELab](n){const e=n.match(Le.CIELab),s=Ue(e[1]),r=kt(e[2]),u=kt(e[3]),p=e[4],v=vn(s,r,u);return p!==void 0&&(v.A=fe(p)),v},[_.CMYK](n){const e=n.match(Le.CMYK),s=$e(e[1]||e[6]),r=$e(e[2]||e[7]),u=$e(e[3]||e[8]),p=$e(e[4]||e[9]),v=e[5]||e[10],S=yn(s,r,u,p);return v!==void 0&&(S.A=fe(v)),S}},Gi={[_.HEX](n){const e={R:Pe(`${n.R}`),G:Pe(`${n.G}`),B:Pe(`${n.B}`)};return pe(n,"A")&&(e.A=Math.min(Pe(`${n.A}`,!0),1)),e},[_.RGB](n){return this.HEX(n)},[_.HSL](n){const e=Ue(`${n.S}`),s=Ue(`${n.L}`),r=ue(vt(n.H),e,s);return pe(n,"A")&&(r.A=fe(n.A)),r},[_.CIELab](n){const e=Ue(`${n.L}`),s=kt(`${n.a}`),r=kt(`${n.b}`),u=vn(e,s,r);return pe(n,"A")&&(u.A=fe(n.A)),u},[_.CMYK](n){const e=$e(`${n.C}`),s=$e(`${n.M}`),r=$e(`${n.Y}`),u=$e(`${n.K}`),p=yn(e,s,r,u);return pe(n,"A")&&(p.A=fe(n.A)),p}},Xe=(n,e=oe(n))=>typeof n=="string"?Qi[e](n):Gi[e](n),D={[_.HEX]:n=>({R:Ot(n.R),G:Ot(n.G),B:Ot(n.B)}),HEXA(n){const e=D.HEX(n);return e.A=pe(n,"A")?Ot(255*n.A):"0xFF",e},[_.RGB](n,e){const s=Ni(n,e);return pe(s,"A")&&delete s.A,s},RGBA(n,e){const s=D.RGB(n,e);return s.A=pe(n,"A")?R(n.A):1,s},[_.HSL](n,e){const s=ot(n.R,n.G,n.B);return delete s.A,gn(s,e)},HSLA(n,e){const s=D.HSL(n,e);return s.A=pe(n,"A")?R(n.A,e):1,s},[_.CIELab](n,e){const s=at(n.R,n.G,n.B);return $i(s,e)},CIELabA(n,e){const s=D.CIELab(n,e);return s.A=pe(n,"A")?R(n.A,e):1,s},[_.CMYK]:(n,e)=>zi(ti(n.R,n.G,n.B),e),CMYKA(n,e){const s=D.CMYK(n,e);return s.A=pe(n,"A")?R(n.A,e):1,s}},Bt=(n,e,s,r)=>{const u=oe(n),p=typeof n=="string",v=Xe(n,u),S=typeof n=="string"&&pe(v,"A")||typeof n!="string"&&pe(n,"A"),B=ot(v.R,v.G,v.B,v.A);S||delete B.A;const d=s?B.L/(e+1):(100-B.L)/(e+1),A=Array(e).fill(null).map((L,C)=>({...B,L:B.L+d*(C+1)*(1-2*+s)}));switch(u){case _.HEX:default:return A.map(L=>{const C=ue(L.H,L.S,L.L);return S&&(C.A=L.A),p?S?M.HEX({...C,A:R(255*C.A)}):M.HEX(C):S?D.HEXA(C):D.HEX(C)});case _.RGB:return A.map(L=>{const C=ue(L.H,L.S,L.L);return S&&(C.A=L.A),p?M.RGB(C,r):S?D.RGBA(C,r.decimals):D.RGB(C,r.decimals)});case _.HSL:return A.map(L=>p?M.HSL(L,r):S?D.HSLA({...ue(L.H,L.S,L.L),A:L.A},r.decimals):D.HSL(ue(L.H,L.S,L.L),r.decimals));case _.CIELab:return A.map(L=>{const C=ue(L.H,L.S,L.L);return p?M.CIELab(S?D.CIELabA(C,r.decimals):D.CIELab(C,r.decimals),r):S?D.CIELabA({...C,A:L.A},r.decimals):D.CIELab(C,r.decimals)})}},tt={buildHarmony(n,e,s,r){const u=oe(n),p=Xe(n,u),v=ot(p.R,p.G,p.B,p.A),S=typeof n=="string"&&pe(p,"A")||typeof n!="string"&&pe(n,"A"),B=typeof n=="string";switch(u){case _.HEX:default:return S?this.HEXA(gn(v,0),e,s,B):this.HEX(gn(v,0),e,s,B);case _.HSL:return S?this.HSLA(v,e,s,B,r):this.HSL(v,e,s,B,r);case _.RGB:return S?this.RGBA(v,e,s,B,r):this.RGB(v,e,s,B,r);case _.CIELab:return S?this.CIELabA(v,e,s,B,r):this.CIELab(v,e,s,B,r)}},[_.HEX]:(n,e,s,r)=>e(n,s).map(u=>r?M.HEX(ue(u.H,u.S,u.L)):D.HEX(ue(u.H,u.S,u.L))),HEXA:(n,e,s,r)=>e(n,s).map(u=>r?M.HEX({...ue(u.H,u.S,u.L),A:255*fe(u.A)}):D.HEXA({...ue(u.H,u.S,u.L),A:fe(u.A)})),[_.RGB]:(n,e,s,r,u)=>e(n,s).map(p=>r?M.RGB(ue(p.H,p.S,p.L),u):D.RGB(ue(p.H,p.S,p.L),u.decimals)),RGBA:(n,e,s,r,u)=>e(n,s).map(p=>r?M.RGB({...ue(p.H,p.S,p.L),A:fe(p.A)},u):D.RGBA({...ue(p.H,p.S,p.L),A:fe(p.A)},u.decimals)),[_.HSL]:(n,e,s,r,u)=>e(n,s).map(p=>r?M.HSL({H:p.H,S:p.S,L:p.L},u):D.HSL(ue(p.H,p.S,p.L),u.decimals)),HSLA:(n,e,s,r,u)=>e(n,s).map(p=>r?M.HSL({...p,A:fe(p.A)},u):D.HSLA({...ue(p.H,p.S,p.L),A:fe(p.A)},u.decimals)),[_.CIELab]:(n,e,s,r,u)=>e(n,s).map(p=>{const v=ue(p.H,p.S,p.L);return r?M.CIELab(at(v.R,v.G,v.B),u):D.CIELab(v,u.decimals)}),CIELabA:(n,e,s,r,u)=>e(n,s).map(p=>{const v=ue(p.H,p.S,p.L);return r?M.CIELab({...at(v.R,v.G,v.B),A:fe(p.A)},u):D.CIELabA({...v,A:fe(p.A)},u.decimals)})},K={mix(n,e){const s=n.map(v=>{const S=oe(v);return Xe(v,S)}),r=e===Z.SUBTRACTIVE?s.map(v=>{const S=((B,d,A)=>{const L=Math.min(B,d,A),C=Math.min(255-B,255-d,255-A),y=B-L,O=d-L,q=A-L,k=Math.min(y,O),z=y-k,F=(O+k)/2,f=(q+O-k)/2,E=Math.max(z,F,f)/Math.max(y,O,q),G=isNaN(E)||E===1/0||E<=0?1:E;return{R:z/G+C,Y:F/G+C,B:f/G+C}})(v.R,v.G,v.B);return pe(v,"A")&&(S.A=v.A),S}):null;function u(v){const S=e===Z.ADDITIVE?{R:0,G:0,B:0,A:0}:{R:0,Y:0,B:0,A:0};return v.reduce((B,d)=>{const A=pe(d,"A")?d.A:1,L={R:Math.min(B.R+d.R*A,255),B:Math.min(B.B+d.B*A,255),A:1-(1-A)*(1-B.A)},C="G"in B?B.G:B.Y,y="G"in d?d.G:d.Y;return{...L,...e===Z.ADDITIVE?{G:Math.min(C+y*A,255)}:{Y:Math.min(C+y*A,255)}}},S)}let p;if(e===Z.ADDITIVE)p=u(s);else{const v=u(r);p=((S,B,d)=>{const A=Math.min(S,B,d),L=Math.min(255-S,255-B,255-d),C=S-A,y=B-A,O=d-A,q=Math.min(y,O),k=C+y-q,z=y+q,F=2*(O-q),f=Math.max(k,z,F)/Math.max(C,y,O),E=isNaN(f)||f===1/0||f<=0?1:f;return{R:k/E+L,G:z/E+L,B:F/E+L}})(v.R,v.Y,v.B),p.A=v.A}return{R:R(p.R),G:R(p.G),B:R(p.B),A:he(p.A,0,1)}},[_.HEX](n,e,s){const r=this.mix(n,e);return delete r.A,s?M.HEX(r):D.HEX(r)},HEXA(n,e,s){const r=this.mix(n,e);return r.A=s?255*fe(r.A):fe(r.A),s?M.HEX(r):D.HEXA(r)},[_.RGB](n,e,s,r){const u=this.mix(n,e);return delete u.A,s?M.RGB(u,r):D.RGB(u,r.decimals)},RGBA(n,e,s,r){const u=this.mix(n,e);return s?M.RGB(u,r):D.RGBA(u,r.decimals)},[_.HSL](n,e,s,r){const u=this.mix(n,e),p=ot(u.R,u.G,u.B);return delete u.A,delete p.A,s?M.HSL(p,r):D.HSL(u,r.decimals)},HSLA(n,e,s,r){const u=this.mix(n,e),p=ot(u.R,u.G,u.B,u.A);return s?M.HSL(p,r):D.HSLA(u,r.decimals)},[_.CIELab](n,e,s,r){const u=this.mix(n,e),p=at(u.R,u.G,u.B);return delete u.A,s?M.CIELab(p,r):D.CIELabA(u,r.decimals)},CIELabA(n,e,s,r){const u=this.mix(n,e),p=at(u.R,u.G,u.B);return pe(u,"A")&&(p.A=u.A),s?M.CIELab(p,r):D.CIELabA(u,r.decimals)}},Ni=(n,e)=>({R:R(n.R,e),G:R(n.G,e),B:R(n.B,e),...pe(n,"A")?{A:R(n.A,e)}:{}}),gn=(n,e)=>({H:R(n.H,e),S:R(n.S,e),L:R(n.L,e),...pe(n,"A")?{A:R(n.A,e)}:{}}),$i=(n,e)=>({L:R(n.L,e),a:R(n.a,e),b:R(n.b,e)}),zi=(n,e)=>({C:R(n.C,e),M:R(n.M,e),Y:R(n.Y,e),K:R(n.K,e)}),be=(n,e,s,r)=>r(Xe(n,e),s),J=(n,e,s,r,u)=>(s<1&&(s=5),((v,S,B)=>{const d=B-1,A=(S.R-v.R)/d,L=(S.G-v.G)/d,C=(S.B-v.B)/d,y=fe(v.A),O=(fe(S.A)-y)/d;return Array(B).fill(null).map((q,k)=>k===0?v:k===d?S:{R:R(v.R+A*k),G:R(v.G+L*k),B:R(v.B+C*k),A:R(y+O*k)})})(Xe(n),Xe(e),s).map(v=>u(v,r))),ln=(n,e,s,r)=>({[qe.ANALOGOUS]:tt.buildHarmony(e,Ri,s,r),[qe.COMPLEMENTARY]:tt.buildHarmony(e,Ii,s,r),[qe.SPLIT_COMPLEMENTARY]:tt.buildHarmony(e,Mi,s,r),[qe.TRIADIC]:tt.buildHarmony(e,_i,s,r),[qe.TETRADIC]:tt.buildHarmony(e,ji,s,r),[qe.SQUARE]:tt.buildHarmony(e,Hi,s,r)})[n];class nt{constructor(e,s={}){this._options=H(s,e),this.rgb=Xe(e),this.updateHSL(),this.updateLab(),this.updateCMYK()}updateRGB(){this.rgb={...ue(this.hsl.H,this.hsl.S,this.hsl.L),A:this.hsl.A}}updateRGBFromCMYK(){this.rgb={...yn(this.cmyk.C,this.cmyk.M,this.cmyk.Y,this.cmyk.K),A:this.rgb.A}}updateRGBFromLab(){this.rgb={...vn(this.lab.L,this.lab.a,this.lab.b),A:this.rgb.A}}updateHSL(){this.hsl=ot(this.rgb.R,this.rgb.G,this.rgb.B,this.rgb.A)}updateLab(){this.lab={...at(this.rgb.R,this.rgb.G,this.rgb.B),A:this.rgb.A}}updateCMYK(){this.cmyk=ti(this.rgb.R,this.rgb.G,this.rgb.B)}setOptions(e={}){return this._options={...this._options,...e},this}setH(e){return this.hsl.H=vt(e),this.updateRGB(),this.updateLab(),this.updateCMYK(),this}setS(e){return this.hsl.S=he(e,0,100),this.updateRGB(),this.updateLab(),this.updateCMYK(),this}setL(e){return this.hsl.L=he(e,0,100),this.updateRGB(),this.updateLab(),this.updateCMYK(),this}setR(e){this.rgb.R=he(e,0,255),this.updateHSL(),this.updateLab(),this.updateCMYK()}setG(e){return this.rgb.G=he(e,0,255),this.updateHSL(),this.updateLab(),this.updateCMYK(),this}setB(e){return this.rgb.B=he(e,0,255),this.updateHSL(),this.updateLab(),this.updateCMYK(),this}setCIEL(e){return this.lab.L=he(e,0,100),this.updateRGBFromLab(),this.updateHSL(),this.updateCMYK(),this}setCIEa(e){return this.lab.a=he(e,-125,125),this.updateRGBFromLab(),this.updateHSL(),this.updateCMYK(),this}setCIEb(e){return this.lab.b=he(e,-125,125),this.updateRGBFromLab(),this.updateHSL(),this.updateCMYK(),this}setA(e){return this.hsl.A=this.rgb.A=he(e,0,1),this}setC(e){return this.cmyk.C=he(e,0,100),this.updateRGBFromCMYK(),this.updateHSL(),this.updateLab(),this}setM(e){return this.cmyk.M=he(e,0,100),this.updateRGBFromCMYK(),this.updateHSL(),this.updateLab(),this}setY(e){return this.cmyk.Y=he(e,0,100),this.updateRGBFromCMYK(),this.updateHSL(),this.updateLab(),this}setK(e){return this.cmyk.K=he(e,0,100),this.updateRGBFromCMYK(),this.updateHSL(),this.updateLab(),this}get options(){return this._options}get H(){return R(this.hsl.H,this.options.decimals)}get S(){return R(this.hsl.S,this.options.decimals)}get L(){return R(this.hsl.L,this.options.decimals)}get CIEL(){return R(this.lab.L,this.options.decimals)}get CIEa(){return R(this.lab.a,this.options.decimals)}get CIEb(){return R(this.lab.b,this.options.decimals)}get R(){return R(this.rgb.R,this.options.decimals)}get G(){return R(this.rgb.G,this.options.decimals)}get B(){return R(this.rgb.B,this.options.decimals)}get A(){return R(this.hsl.A,this.options.decimals)}get C(){return R(this.cmyk.C,this.options.decimals)}get M(){return R(this.cmyk.M,this.options.decimals)}get Y(){return R(this.cmyk.Y,this.options.decimals)}get K(){return R(this.cmyk.K,this.options.decimals)}get HEXObject(){return D.HEX(this.rgb)}get HEXAObject(){return D.HEXA(this.rgb)}get RGBObject(){return{R:this.R,G:this.G,B:this.B}}get RGBAObject(){return{...this.RGBObject,A:this.A}}get HSLObject(){return{H:this.H,S:this.S,L:this.L}}get HSLAObject(){return{...this.HSLObject,A:this.A}}get CIELabObject(){return{L:this.CIEL,a:this.CIEa,b:this.CIEb}}get CIELabAObject(){return{...this.CIELabObject,A:this.A}}get CMYKObject(){return{C:this.C,M:this.M,Y:this.Y,K:this.K}}get CMYKAObject(){return{...this.CMYKObject,A:this.A}}get HEX(){return M.HEX({R:this.R,G:this.G,B:this.B})}get HEXA(){return M.HEX({R:this.R,G:this.G,B:this.B,A:255*this.A})}get RGB(){return M.RGB({R:this.R,G:this.G,B:this.B},this.options)}get RGBA(){return M.RGB({R:this.R,G:this.G,B:this.B,A:this.A},this.options)}get HSL(){return M.HSL({H:this.H,S:this.S,L:this.L},this.options)}get HSLA(){return M.HSL({H:this.H,S:this.S,L:this.L,A:this.A},this.options)}get CIELab(){return M.CIELab({L:this.CIEL,a:this.CIEa,b:this.CIEb},this.options)}get CIELabA(){return M.CIELab({L:this.CIEL,a:this.CIEa,b:this.CIEb,A:this.A},this.options)}get CMYK(){return M.CMYK({C:this.C,M:this.M,Y:this.Y,K:this.K},this.options)}get CMYKA(){return M.CMYK({C:this.C,M:this.M,Y:this.Y,K:this.K,A:this.A},this.options)}static toHEXObject(e){const s=oe(e);return be(e,s,0,D.HEX)}static toHEX(e){return M.HEX(nt.toHEXObject(e))}static toHEXAObject(e){const s=oe(e);return be(e,s,0,D.HEXA)}static toHEXA(e){return M.HEX(nt.toHEXAObject(e))}static toRGBObject(e,s={}){const r=oe(e);return be(e,r,s.decimals,D.RGB)}static toRGB(e,s={}){const r=oe(e),u=H(s,e),p=be(e,r,s.decimals,D.RGB);return M.RGB(p,u)}static toRGBAObject(e,s={}){const r=oe(e);return be(e,r,s.decimals,D.RGBA)}static toRGBA(e,s={}){const r=oe(e),u=H(s,e),p=be(e,r,s.decimals,D.RGBA);return M.RGB(p,u)}static toHSLObject(e,s={}){const r=oe(e);return be(e,r,s.decimals,D.HSL)}static toHSL(e,s={}){const r=oe(e),u=H(s,e),p=be(e,r,s.decimals,D.HSL);return M.HSL(p,u)}static toHSLAObject(e,s={}){const r=oe(e);return be(e,r,s.decimals,D.HSLA)}static toHSLA(e,s={}){const r=oe(e),u=H(s,e),p=be(e,r,s.decimals,D.HSLA);return M.HSL(p,u)}static toCIELabObject(e,s={}){const r=oe(e);return be(e,r,s.decimals,D.CIELab)}static toCIELab(e,s={}){const r=oe(e),u=H(s,e),p=be(e,r,s.decimals,D.CIELab);return M.CIELab(p,u)}static toCIELabAObject(e,s={}){const r=oe(e);return be(e,r,s.decimals,D.CIELabA)}static toCIELabA(e,s={}){const r=oe(e),u=H(s,e),p=be(e,r,s.decimals,D.CIELabA);return M.CIELab(p,u)}static toCMYKObject(e,s={}){const r=oe(e);return be(e,r,s.decimals,D.CMYK)}static toCMYK(e,s={}){const r=oe(e),u=H(s,e),p=be(e,r,s.decimals,D.CMYK);return M.CMYK(p,u)}static toCMYKAObject(e,s={}){const r=oe(e);return be(e,r,s.decimals,D.CMYKA)}static toCMYKA(e,s={}){const r=oe(e),u=H(s,e),p=be(e,r,s.decimals,D.CMYKA);return M.CMYK(p,u)}static getBlendHEXObject(e,s,r=5){return J(e,s,r,0,D.HEX)}static getBlendHEX(e,s,r=5){return nt.getBlendHEXObject(e,s,r).map(u=>M.HEX(u))}static getBlendHEXAObject(e,s,r=5){return J(e,s,r,0,D.HEXA)}static getBlendHEXA(e,s,r=5){return nt.getBlendHEXAObject(e,s,r).map(u=>M.HEX(u))}static getBlendRGBObject(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.RGB):J(e,s,5,r==null?void 0:r.decimals,D.RGB)}static getBlendRGB(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.RGB).map(p=>M.RGB(p,H(u||{},e,s))):J(e,s,5,r==null?void 0:r.decimals,D.RGB).map(p=>M.RGB(p,H(r||{},e,s)))}static getBlendRGBAObject(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.RGBA):J(e,s,5,r==null?void 0:r.decimals,D.RGBA)}static getBlendRGBA(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.RGBA).map(p=>M.RGB(p,H(u||{},e,s))):J(e,s,5,r==null?void 0:r.decimals,D.RGBA).map(p=>M.RGB(p,H(r||{},e,s)))}static getBlendHSLObject(e,s,r,u){return J(e,s,typeof r=="number"?r:5,u==null?void 0:u.decimals,D.HSL)}static getBlendHSL(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.HSL).map(p=>M.HSL(p,H(u||{},e,s))):J(e,s,5,r==null?void 0:r.decimals,D.HSL).map(p=>M.HSL(p,H(r||{},e,s)))}static getBlendHSLAObject(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.HSLA):J(e,s,5,r==null?void 0:r.decimals,D.HSLA)}static getBlendHSLA(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.HSLA).map(p=>M.HSL(p,H(u||{},e,s))):J(e,s,5,r==null?void 0:r.decimals,D.HSLA).map(p=>M.HSL(p,H(r||{},e,s)))}static getBlendCIELabObject(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.CIELab):J(e,s,5,r==null?void 0:r.decimals,D.CIELab)}static getBlendCIELab(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.CIELab).map(p=>M.CIELab(p,H(u||{},e,s))):J(e,s,5,r==null?void 0:r.decimals,D.CIELab).map(p=>M.CIELab(p,H(r||{},e,s)))}static getBlendCIELabAObject(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.CIELabA):J(e,s,5,r==null?void 0:r.decimals,D.CIELabA)}static getBlendCIELabA(e,s,r,u){return typeof r=="number"?J(e,s,r,u==null?void 0:u.decimals,D.CIELabA).map(p=>M.CIELab(p,H(u||{},e,s))):J(e,s,5,r==null?void 0:r.decimals,D.CIELabA).map(p=>M.CIELab(p,H(r||{},e,s)))}static getMixHEXObject(e,s=Z.ADDITIVE){return K.HEX(e,s,!1)}static getMixHEX(e,s=Z.ADDITIVE){return K.HEX(e,s,!0)}static getMixHEXAObject(e,s=Z.ADDITIVE){return K.HEXA(e,s,!1)}static getMixHEXA(e,s=Z.ADDITIVE){return K.HEXA(e,s,!0)}static getMixRGBObject(e,s,r){return typeof s=="string"?K.RGB(e,s,!1,H(r||{},...e)):K.RGB(e,Z.ADDITIVE,!1,H(s||{},...e))}static getMixRGB(e,s,r){return typeof s=="string"?K.RGB(e,s,!0,H(r||{},...e)):K.RGB(e,Z.ADDITIVE,!0,H(s||{},...e))}static getMixRGBAObject(e,s,r){return typeof s=="string"?K.RGBA(e,s,!1,H(r||{},...e)):K.RGBA(e,Z.ADDITIVE,!1,H(s||{},...e))}static getMixRGBA(e,s,r){return typeof s=="string"?K.RGBA(e,s,!0,H(r||{},...e)):K.RGBA(e,Z.ADDITIVE,!0,H(s||{},...e))}static getMixHSLObject(e,s,r){return typeof s=="string"?K.HSL(e,s,!1,H(r||{},...e)):K.HSL(e,Z.ADDITIVE,!1,H(s||{},...e))}static getMixHSL(e,s,r){return typeof s=="string"?K.HSL(e,s,!0,H(r||{},...e)):K.HSL(e,Z.ADDITIVE,!0,H(s||{},...e))}static getMixHSLAObject(e,s,r){return typeof s=="string"?K.HSLA(e,s,!1,H(r||{},...e)):K.HSLA(e,Z.ADDITIVE,!1,H(s||{},...e))}static getMixHSLA(e,s,r){return typeof s=="string"?K.HSLA(e,s,!0,H(r||{},...e)):K.HSLA(e,Z.ADDITIVE,!0,H(s||{},...e))}static getMixCIELabObject(e,s,r){return typeof s=="string"?K.CIELab(e,s,!1,H(r||{},...e)):K.CIELab(e,Z.ADDITIVE,!1,H(s||{},...e))}static getMixCIELab(e,s,r){return typeof s=="string"?K.CIELab(e,s,!0,H(r||{},...e)):K.CIELab(e,Z.ADDITIVE,!0,H(s||{},...e))}static getMixCIELabAObject(e,s,r){return typeof s=="string"?K.CIELabA(e,s,!1,H(r||{},...e)):K.CIELabA(e,Z.ADDITIVE,!1,H(s||{},...e))}static getMixCIELabA(e,s,r){return typeof s=="string"?K.CIELabA(e,s,!0,H(r||{},...e)):K.CIELabA(e,Z.ADDITIVE,!0,H(s||{},...e))}static getShades(e,s,r){return typeof s=="number"?Bt(e,s,!0,H(r||{},e)):Bt(e,5,!0,H(s||{},e))}static getTints(e,s,r){return typeof s=="number"?Bt(e,s,!1,H(r||{},e)):Bt(e,5,!1,H(s||{},e))}static getHarmony(e,s,r,u){return`${s}`in qe?ln(s,e,sn(r)?r:Z.ADDITIVE,H(sn(r)?u||{}:r||{},e)):sn(s)?ln(qe.COMPLEMENTARY,e,s,H(r||{},e)):ln(qe.COMPLEMENTARY,e,Z.ADDITIVE,H(s||{},e))}}const Yi=`#version 300 es

precision highp float;
precision highp int;

#define TEO_WIDTH 1.0
#define AA 4
#define SIDE %side%
#define MAX_EXPR 256

#define INV_LN10 0.4342944819

#define FLT_MAX 3.402823466e+38
#define FLT_MIN 1.175494351e-38

uniform ivec2 origin;
uniform int squareMant, squareExp, squareSize;
uniform int maxExpr;
uniform vec4 expressions[MAX_EXPR];

const int WIDTH = int(TEO_WIDTH*float(AA)); 

int fneg(float x) { return (x < 0.0)? 1:0; }

float ln(float x) { return (x <= 0.0)? FLT_MIN : log(x); }

float log10(float x) { return (x <= 0.0)? FLT_MIN : (INV_LN10 * log(x)) ; }

float sqrtf(float x) { return (x <= 0.0)? FLT_MIN : sqrt(x); }

//To change dinamically the eval function
ivec2 eval(ivec2 p, int opt) {
    float pixel = (float(squareMant) * pow(10.0, float(squareExp))) / float(squareSize); 
    float unit = pixel/float(AA);
    float x = float(p.x)*unit, y = float(p.y)*unit;

    ivec2 ret;

    switch(opt) {
        %REPLACE_CODE%
        
    default:
        break;
    }

    return ret;
}

bool line(ivec2 p, int opt) {
    ivec2 a = eval(p + ivec2(-WIDTH, -WIDTH), opt);
    ivec2 b = eval(p + ivec2(WIDTH+1, WIDTH+1), opt);
    ivec2 c = eval(p + ivec2(-WIDTH, WIDTH+1), opt);
    ivec2 d = eval(p + ivec2(WIDTH+1, -WIDTH), opt);

    int g = a.x + b.x + c.x + d.x;
    bool denominators = a.y == b.y && b.y == c.y && c.y == d.y;

    return 0 < g && g < 4 && denominators;
}

vec4 lineColor(ivec2 p, int opt, vec3 rgb) {
    int count = 0;
    for(int i=0; i<AA; ++i) {
        for(int j=0; j<AA; ++j) {
            ivec2 np = p + ivec2(i, j);
            count += int(line(np, opt));
        }
    }

    float alpha = float(count)/float(AA*AA);
    return vec4(rgb*alpha, alpha);
}


vec4 blend(vec4 a, vec4 b) {
    float p = a.a, q = 1.0-p;
    return vec4(
        a.r*p + b.r*q,
        a.g*p + b.g*q,
        a.b*p + b.b*q,
        a.a*p + b.a*q
    );
}

out vec4 fragColor;

void main() {
    ivec2 p = ivec2(
        int(gl_FragCoord.x) - origin.x, 
        int(gl_FragCoord.y) + origin.y - SIDE
    ) * AA;
    vec4 color = vec4(0.0, 0.0, 0.0, 0.0);

    for(int i=0; i<MAX_EXPR; i++) {
        if(i >= maxExpr) break;
        if(expressions[i].a < 0.9) continue;
        
        vec3 rgbColor = expressions[i].rgb;
        color = blend(color, lineColor(p, i, rgbColor));
    }

    fragColor = color;
}

`;let we;const Pi=document.getElementById("calculator"),P=Pi.getContext("webgl2",{premultipliedAlpha:!1});let En=!0;function Mt(){En=!0}Ui();async function Ui(){let n,e,s,r=performance.now(),u=0;(async function S(){if(En&&(console.time("update"),await p(),console.timeEnd("update"),En=!1),window.requestAnimationFrame(S),v(),P.clearColor(1,1,0,1),P.viewport(0,0,P.canvas.width,P.canvas.height),P.clear(P.COLOR_BUFFER_BIT),P.bindBuffer(P.ARRAY_BUFFER,e),P.enableVertexAttribArray(n),P.vertexAttribPointer(n,2,P.FLOAT,!1,0,0),!we)throw Error("There is no webgl shader program");const B=P.getUniformLocation(we,"origin");P.uniform2i(B,U.x,U.y);const d=P.getUniformLocation(we,"squareMant"),A=P.getUniformLocation(we,"squareExp"),L=P.getUniformLocation(we,"squareSize");P.uniform1i(d,U.mant),P.uniform1i(A,U.exp),P.uniform1i(L,U.size);const C=Array.from(ve,([q,k])=>{const z=new nt(k.color);return[z.R/255,z.G/255,z.B/255,k.visible?1:0]}),y=P.getUniformLocation(we,"maxExpr"),O=P.getUniformLocation(we,"expressions");P.uniform1i(y,C.length),C.length>0&&P.uniform4fv(O,C.flat(1)),P.drawArrays(P.TRIANGLES,0,6),ci()})();async function p(){s=await Ki(),await Xi(P,s),n=P.getAttribLocation(we,"a_position"),e=P.createBuffer(),P.bindBuffer(P.ARRAY_BUFFER,e),P.bufferData(P.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),P.STATIC_DRAW)}function v(){let S=performance.now();if(S-r>1e3){const d=document.getElementById("fps");d.innerHTML=`FPS: ${u}`,r=S,u=0}u++}}function $n(n,e,s){const r=n.createShader(e);return n.shaderSource(r,s),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(console.error("Error compiling shader:",n.getShaderInfoLog(r)),n.deleteShader(r),null)}async function Xi(n,e){const s=`#version 300 es
    in vec4 a_position;
    void main() { gl_Position = a_position; }`,r=$n(n,n.FRAGMENT_SHADER,e),u=$n(n,n.VERTEX_SHADER,s);if(we=n.createProgram(),n.attachShader(we,u),n.attachShader(we,r),n.linkProgram(we),n.useProgram(we),!n.getProgramParameter(we,n.LINK_STATUS))return console.error(`Unable to initialize the shader program: ${n.getProgramInfoLog(we)}`),null}async function Ki(){let n=Yi;n=n.replace("%side%",de.toString());const e=Vi();return n=n.replace("%REPLACE_CODE%",e),n}function Vi(){const n=Array.from(ve,([s,r])=>r.code);let e="";for(let s in n)n[s]&&(e+=`
            case ${s}:
                ${n[s]}
                break;
            `);return console.log(e),e}const cn=document.getElementById("more"),un=document.getElementById("sidebar");cn==null||cn.addEventListener("click",()=>{const n=Tt.createNew();un==null||un.appendChild(n.htmlElement),n.htmlElement.addEventListener("keydown",e=>{var s,r;if(e.key=="ArrowUp"){const u=[...ve.keys()].indexOf(n.number)-1;u>=0&&((s=[...ve.values()][u])==null||s.focus())}else if(e.key=="ArrowDown"){const u=[...ve.keys()].indexOf(n.number)+1;u<ve.size&&((r=[...ve.values()][u])==null||r.focus())}}),n.focus(),Mt()});const hn=document.getElementById("home");hn==null||hn.addEventListener("click",li);window.addEventListener("DOMContentLoaded",()=>{Mt()});async function Wi(n,e,s){const r=ve.get(n);if(!r)throw Error("There isn't any equations to edit");r.error=!1,r.code=void 0,s==It.ADD&&r.writeFunctionBrackets();let u=Array.from(ve,([v,S])=>S.number).findIndex(v=>v==n),p;try{const v=r.variableCharacter(),S=r.functionCharacter();if(p=r.getVariables(),r.showUndefinedVariables(p)>0){r.toggleError();return}if(v){if(r.hideSolutionBox(),rt.has(v)&&rt.get(v)!==n)throw Error("There's already a function with this name");r.setDrawable(!1),rt.set(v,n);const B=await er(v,r,e.substring(2),s);r.setSolutionValue(B),r.toggleError();return}else r.setDrawable(!0);if(S){if(it.has(S)&&it.get(S)!==n)throw Error("There's already a function with this name");if([...p].some(B=>B==S))throw Error("A variable can't be called like a function");p.delete(S),r.showUndefinedVariables(p),it.set(S,n),await Zi(S,e,r,s,u),r.toggleError();return}}catch(v){console.warn(v),r.writeError(v);return}try{const v=await pi(e,u);v.num!==null&&v.num!==void 0?r.setSolutionValue(v.num):(r.hideSolutionBox(),r.code=v.code),Mt()}catch(v){if(!v.startsWith("Empty error")){console.warn(v),r.writeError(v);return}}r.toggleError()}const Zi=async(n,e,s,r,u)=>{var S;const p=e.substring(e.indexOf("=")+1),v=Math.min(e.indexOf("x")>0?e.indexOf("x"):1e9,e.indexOf("y")>0?e.indexOf("y"):1e9);try{n+=e[v];const B=await mi(n,p,u);if(r!=It.REFRESH)for(let d of ve.keys())d!=s.number&&((S=ve.get(d))==null||S.refresh());s.code=B.code,Mt()}catch(B){if(!B.startsWith("Empty error")){console.warn(B),s.writeError(B);return}}},Ji=async(n,e)=>{try{bi(n),ve.forEach(s=>s.refresh())}catch(s){console.warn(s),e.writeError(s)}},er=async(n,e,s,r)=>{const u=e.getVariables();if(u.has("x")||u.has("y")){e.writeError(new Error("A variable can't have x nor y because it has to be constant"));return}try{const p=await gi(n,s);return r!=It.REFRESH&&ve.forEach(v=>v.refresh()),p}catch(p){console.warn(p),e.writeError(p)}},tr=async(n,e)=>{try{Ei(n),ve.forEach(s=>s.refresh())}catch(s){console.warn(s),e.writeError(s)}};
